(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1767],{94617:function(e,t,l){(window.__NEXT_P=window.__NEXT_P||[]).push(["/construct/flow/canvas",function(){return l(37560)}])},45247:function(e,t,l){"use strict";var a=l(85893),n=l(50888);t.Z=function(e){let{visible:t}=e;return t?(0,a.jsx)("div",{className:"absolute w-full h-full top-0 left-0 flex justify-center items-center z-10 bg-white dark:bg-black bg-opacity-50 dark:bg-opacity-50 backdrop-blur-sm text-3xl animate-fade animate-duration-200",children:(0,a.jsx)(n.Z,{})}):null}},99743:function(e,t,l){"use strict";var a=l(85893);l(67294);var n=l(36851);t.Z=e=>{let{id:t,sourceX:l,sourceY:r,targetX:s,targetY:o,sourcePosition:i,targetPosition:d,style:c={},data:u,markerEnd:p}=e,[m,f,x]=(0,n.OQ)({sourceX:l,sourceY:r,sourcePosition:i,targetX:s,targetY:o,targetPosition:d}),v=(0,n._K)();return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.u5,{id:t,style:c,path:m,markerEnd:p}),(0,a.jsx)("foreignObject",{width:40,height:40,x:f-20,y:x-20,className:"bg-transparent w-10 h-10 relative",requiredExtensions:"http://www.w3.org/1999/xhtml",children:(0,a.jsx)("button",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-5 h-5 rounded-full bg-stone-400 dark:bg-zinc-700 cursor-pointer text-sm",onClick:e=>{e.stopPropagation(),v.setEdges(v.getEdges().filter(e=>e.id!==t))},children:"\xd7"})})]})}},37560:function(e,t,l){"use strict";l.r(t),l.d(t,{default:function(){return eL}});var a=l(85893),n=l(76212),r=l(45247),s=l(24969),o=l(69677),i=l(40411),d=l(55241),c=l(47221),u=l(14726),p=l(67294),m=l(67421),f=l(62418),x=l(2487),v=l(7134),h=l(32983),j=e=>{let{nodes:t}=e,{t:l}=(0,m.$G)();return(null==t?void 0:t.length)>0?(0,a.jsx)(x.Z,{className:"overflow-hidden overflow-y-auto w-full",itemLayout:"horizontal",dataSource:t,renderItem:e=>(0,a.jsx)(x.Z.Item,{className:"cursor-move hover:bg-[#F1F5F9] dark:hover:bg-theme-dark p-0 py-2",draggable:!0,onDragStart:t=>{t.dataTransfer.setData("application/reactflow",JSON.stringify(e)),t.dataTransfer.effectAllowed="move"},children:(0,a.jsx)(x.Z.Item.Meta,{className:"flex items-center justify-center",avatar:(0,a.jsx)(v.C,{src:"/icons/node/vis.png",size:"large"}),title:(0,a.jsx)("p",{className:"line-clamp-1 font-medium",children:e.label}),description:(0,a.jsx)("p",{className:"line-clamp-2",children:e.description})})})}):(0,a.jsx)(h.Z,{className:"px-2",description:l("no_node")})};let{Search:g}=o.default;var b=()=>{let{t:e}=(0,m.$G)(),[t,l]=(0,p.useState)([]),[r,o]=(0,p.useState)([]),[x,v]=(0,p.useState)([]),[h,b]=(0,p.useState)([]),[w,y]=(0,p.useState)("");async function _(){let[e,t]=await (0,n.Vx)((0,n.As)());if(t&&t.length>0){localStorage.setItem(f.zN,JSON.stringify(t));let e=t.filter(e=>"operator"===e.flow_type),a=t.filter(e=>"resource"===e.flow_type);l(e),o(a),v(N(e)),b(N(a))}}function N(e){let t=[],l={};return e.forEach(e=>{let{category:a,category_label:n}=e;l[a]||(l[a]={category:a,categoryLabel:n,nodes:[]},t.push(l[a])),l[a].nodes.push(e)}),t}(0,p.useEffect)(()=>{_()},[]);let Z=(0,p.useMemo)(()=>{if(!w)return x.map(e=>{let{category:t,categoryLabel:l,nodes:n}=e;return{key:t,label:l,children:(0,a.jsx)(j,{nodes:n}),extra:(0,a.jsx)(i.Z,{showZero:!0,count:n.length||0,style:{backgroundColor:n.length>0?"#52c41a":"#7f9474"}})}});{let e=t.filter(e=>e.label.toLowerCase().includes(w.toLowerCase()));return N(e).map(e=>{let{category:t,categoryLabel:l,nodes:n}=e;return{key:t,label:l,children:(0,a.jsx)(j,{nodes:n}),extra:(0,a.jsx)(i.Z,{showZero:!0,count:n.length||0,style:{backgroundColor:n.length>0?"#52c41a":"#7f9474"}})}})}},[x,w]),k=(0,p.useMemo)(()=>{if(!w)return h.map(e=>{let{category:t,categoryLabel:l,nodes:n}=e;return{key:t,label:l,children:(0,a.jsx)(j,{nodes:n}),extra:(0,a.jsx)(i.Z,{showZero:!0,count:n.length||0,style:{backgroundColor:n.length>0?"#52c41a":"#7f9474"}})}});{let e=r.filter(e=>e.label.toLowerCase().includes(w.toLowerCase()));return N(e).map(e=>{let{category:t,categoryLabel:l,nodes:n}=e;return{key:t,label:l,children:(0,a.jsx)(j,{nodes:n}),extra:(0,a.jsx)(i.Z,{showZero:!0,count:n.length||0,style:{backgroundColor:n.length>0?"#52c41a":"#7f9474"}})}})}},[h,w]);return(0,a.jsx)(d.Z,{placement:"bottom",trigger:["click"],content:(0,a.jsxs)("div",{className:"w-[320px] overflow-hidden overflow-y-auto scrollbar-default",children:[(0,a.jsx)("p",{className:"my-2 font-bold",children:e("add_node")}),(0,a.jsx)(g,{placeholder:"Search node",onSearch:function(e){y(e)}}),(0,a.jsx)("h2",{className:"my-2 ml-2 font-semibold",children:e("operators")}),(0,a.jsx)(c.Z,{className:"max-h-[300px] overflow-hidden overflow-y-auto scrollbar-default",size:"small",defaultActiveKey:[""],items:Z}),(0,a.jsx)("h2",{className:"my-2 ml-2 font-semibold",children:e("resource")}),(0,a.jsx)(c.Z,{className:"max-h-[300px] overflow-hidden overflow-y-auto scrollbar-default",size:"small",defaultActiveKey:[""],items:k})]}),children:(0,a.jsx)(u.ZP,{type:"primary",className:"flex items-center justify-center rounded-full left-4 top-4",style:{zIndex:1050},icon:(0,a.jsx)(s.Z,{})})})},w=l(99743),y=l(25675),_=l.n(y),N=l(99859),Z=l(92797),k=l(34041),C=l(84567),I=l(45360),P=l(7075),S=l(86738),F=l(83062),E=l(36851),z=e=>{let{optional:t}=e;return t?null:(0,a.jsx)("span",{className:"text-red-600 align-middle inline-block",children:"\xa0*"})},V=l(45605),O=l(93967),A=l.n(O),T=e=>{let{node:t,data:l,type:n,label:r,index:o}=e,{t:i}=(0,m.$G)(),d=(0,E._K)(),[c,u]=p.useState([]);function x(){let e=localStorage.getItem(f.zN);if(!e)return;let a=JSON.parse(e),n=l.type_cls,s=[];"inputs"===r?s=a.filter(e=>"operator"===e.flow_type).filter(e=>{var t;return null===(t=e.outputs)||void 0===t?void 0:t.some(e=>e.type_cls===n&&e.is_list===(null==l?void 0:l.is_list))}):"parameters"===r?s=a.filter(e=>"resource"===e.flow_type).filter(e=>{var t;return null===(t=e.parent_cls)||void 0===t?void 0:t.includes(n)}):"outputs"===r&&("operator"===t.flow_type?s=a.filter(e=>"operator"===e.flow_type).filter(e=>{var t;return null===(t=e.inputs)||void 0===t?void 0:t.some(e=>e.type_cls===n&&e.is_list===(null==l?void 0:l.is_list))}):"resource"===t.flow_type&&(s=a.filter(e=>{var l,a;return(null===(l=e.inputs)||void 0===l?void 0:l.some(e=>{var l;return null===(l=t.parent_cls)||void 0===l?void 0:l.includes(e.type_cls)}))||(null===(a=e.parameters)||void 0===a?void 0:a.some(e=>{var l;return null===(l=t.parent_cls)||void 0===l?void 0:l.includes(e.type_cls)}))}))),u(s)}return(0,a.jsxs)("div",{className:A()("relative flex items-center",{"justify-start":"parameters"===r||"inputs"===r,"justify-end":"outputs"===r}),children:[(0,a.jsx)(E.HH,{className:A()("w-2 h-2","source"===n?"-mr-4":"-ml-4"),type:n,position:"source"===n?E.Ly.Right:E.Ly.Left,id:"".concat(t.id,"|").concat(r,"|").concat(o),isValidConnection:e=>(function(e){let{sourceHandle:t,targetHandle:l,source:a,target:n}=e,r=d.getNode(a),s=d.getNode(n),{flow_type:o}=null==r?void 0:r.data,{flow_type:c}=null==s?void 0:s.data,u=null==t?void 0:t.split("|")[1],p=null==l?void 0:l.split("|")[1],m=null==t?void 0:t.split("|")[2],f=null==l?void 0:l.split("|")[2],x=null==s?void 0:s.data[p][f].type_cls;if(o===c&&"operator"===o){let e=null==r?void 0:r.data[u][m].type_cls,t=null==r?void 0:r.data[u][m].is_list,l=null==s?void 0:s.data[p][f].is_list;return e===x&&t===l}if("resource"===o&&("operator"===c||"resource"===c)){let e=null==r?void 0:r.data.parent_cls;return e.includes(x)}return I.ZP.warning(i("connect_warning")),!1})(e)}),(0,a.jsxs)(P.Z,{className:A()("bg-white dark:bg-[#232734] w-full px-2 py-1 rounded text-neutral-500",{"text-right":"outputs"===r}),children:[(0,a.jsx)(S.Z,{placement:"left",icon:null,showCancel:!1,okButtonProps:{className:"hidden"},title:i("related_nodes"),description:(0,a.jsx)("div",{className:"w-60",children:(0,a.jsx)(j,{nodes:c})}),children:["inputs","parameters"].includes(r)&&(0,a.jsx)(s.Z,{className:"cursor-pointer",onClick:x})}),"outputs"!==r&&(0,a.jsx)(z,{optional:l.optional}),l.type_name,l.description&&(0,a.jsx)(F.Z,{title:l.description,children:(0,a.jsx)(V.Z,{className:"ml-2 cursor-pointer"})}),(0,a.jsx)(S.Z,{placement:"right",icon:null,showCancel:!1,okButtonProps:{className:"hidden"},title:i("related_nodes"),description:(0,a.jsx)("div",{className:"w-60",children:(0,a.jsx)(j,{nodes:c})}),children:["outputs"].includes(r)&&(0,a.jsx)(s.Z,{className:"ml-2 cursor-pointer",onClick:x})})]})]})},D=l(67919);let L=e=>{var t;let l=(0,D.It)((null==e?void 0:null===(t=e.ui)||void 0===t?void 0:t.attr)||{});return(0,a.jsx)(k.default,{...l,className:"w-full nodrag",placeholder:"please select",options:e.options})};var M=l(3303);let G=e=>{var t;let l=(0,D.It)((null===(t=e.ui)||void 0===t?void 0:t.attr)||{});return(0,a.jsx)(M.Z,{...l,options:e.options,placeholder:"please select",className:"w-full nodrag"})};var q=l(85674);let R=e=>{var t;let l=(0,D.It)((null===(t=e.ui)||void 0===t?void 0:t.attr)||{});return(0,a.jsx)(q.default,{...l,className:"w-full",placeholder:"please select a date"})};var $=l(4711);let U=e=>{let t=e.match(/^icon:(\w+)$/);if(t){let e=t[1],l=$[e];return l?(0,a.jsx)(l,{}):null}return null},B=e=>{var t,l,n;let r=(0,D.It)((null===(t=e.ui)||void 0===t?void 0:t.attr)||{});return r.prefix=U((null===(l=e.ui)||void 0===l?void 0:null===(n=l.attr)||void 0===n?void 0:n.prefix)||""),(0,a.jsx)(o.default,{...r,className:"w-full",placeholder:"please input",allowClear:!0})},J=e=>{var t,l;let n=(0,D.It)((null===(t=e.ui)||void 0===t?void 0:t.attr)||{});return(null===(l=e.options)||void 0===l?void 0:l.length)>0&&(0,a.jsx)("div",{className:"bg-white p-2 rounded",children:(0,a.jsx)(C.Z.Group,{...n,options:e.options})})};var K=l(78045);let H=e=>{var t;let l=(0,D.It)((null===(t=e.ui)||void 0===t?void 0:t.attr)||{});return(0,a.jsx)("div",{className:"bg-white p-2 rounded",children:(0,a.jsx)(K.ZP.Group,{...l,options:e.options})})},{TextArea:W}=o.default,X=e=>{var t;let l=(0,D.It)((null===(t=e.ui)||void 0===t?void 0:t.attr)||{});return(0,a.jsx)("div",{className:A()({"mb-3":!0===l.showCount}),children:(0,a.jsx)(W,{className:"nowheel",...l})})};var Y=l(71338);let Q=e=>{var t;let l=(0,D.It)((null===(t=e.ui)||void 0===t?void 0:t.attr)||{});return(0,a.jsx)(Y.Z,{className:"mt-8 nodrag",...l,tooltip:{open:!0}})};var ee=l(68351);let et=e=>{var t;let l=(0,D.It)((null===(t=e.ui)||void 0===t?void 0:t.attr)||{});return(0,a.jsx)(ee.Z,{...l,className:"w-full",placeholder:"please select a moment"})};var el=l(59847);let ea=e=>{var t;let l=(0,D.It)((null===(t=e.ui)||void 0===t?void 0:t.attr)||{});return(0,a.jsx)(el.Z,{...l,className:"w-full nodrag",treeDefaultExpandAll:!0,treeData:e.options})};var en=l(85576),er=l(63764);let es=e=>{var t,l,n,r,s,o,i,d;let{t:c}=(0,m.$G)(),f=(0,D.It)((null===(t=e.ui)||void 0===t?void 0:t.attr)||{}),[x,v]=(0,p.useState)(!1),h=(0,p.useMemo)(()=>{var t,l,a,n;return(null==e?void 0:null===(t=e.ui)||void 0===t?void 0:null===(l=t.editor)||void 0===l?void 0:l.width)?(null==e?void 0:null===(a=e.ui)||void 0===a?void 0:null===(n=a.editor)||void 0===n?void 0:n.width)+100:"80%"},[null==e?void 0:null===(l=e.ui)||void 0===l?void 0:null===(n=l.editor)||void 0===n?void 0:n.width]);return(0,a.jsxs)("div",{className:"p-2 text-sm",children:[(0,a.jsx)(u.ZP,{type:"default",onClick:()=>{v(!0)},children:c("Open_Code_Editor")}),(0,a.jsx)(en.default,{title:c("Code_Editor"),width:h,open:x,onOk:()=>{v(!1)},onCancel:()=>{v(!1)},children:(0,a.jsx)(N.default.Item,{name:null==e?void 0:e.name,children:(0,a.jsx)(er.ZP,{...f,width:(null==e?void 0:null===(r=e.ui)||void 0===r?void 0:null===(s=r.editor)||void 0===s?void 0:s.width)||"100%",height:(null==e?void 0:null===(o=e.ui)||void 0===o?void 0:null===(i=o.editor)||void 0===i?void 0:i.height)||200,defaultLanguage:null==e?void 0:null===(d=e.ui)||void 0===d?void 0:d.language,theme:"vs-dark",options:{minimap:{enabled:!1},wordWrap:"on"}})})})]})};var eo=l(88484),ei=l(23799),ed=l(83454);let ec=e=>{var t,l,n,r;let{t:s}=(0,m.$G)(),o=(0,p.useRef)([]),{data:i,onChange:d}=e,c=(0,D.It)((null===(t=i.ui)||void 0===t?void 0:t.attr)||{}),[f,x]=(0,p.useState)(!1),[v,h]=(0,p.useState)(""),j=e=>{o.current.length===i.ui.attr.max_count&&o.current.pop(),o.current.push(e),null==d||d(o.current.toString())},g=e=>{let t=o.current.indexOf(e.response.data[0].uri);-1!==t&&o.current.splice(t,1),null==d||d(o.current.toString())},b={name:"files",action:ed.env.API_BASE_URL+i.ui.action,headers:{authorization:"authorization-text"},onChange(e){x(!0),e.file.status,"done"===e.file.status?(x(!1),I.ZP.success("".concat(e.file.response.data[0].file_name," ").concat(s("Upload_Data_Successfully"))),j(e.file.response.data[0].uri)):"error"===e.file.status&&(x(!1),I.ZP.error("".concat(e.file.response.data[0].file_name,"  ").concat(s("Upload_Data_Failed"))))}};return(null===(l=i.ui)||void 0===l?void 0:l.file_types)&&Array.isArray(null===(n=i.ui)||void 0===n?void 0:n.file_types)&&h(null===(r=i.ui)||void 0===r?void 0:r.file_types.toString()),(0,a.jsx)("div",{className:"p-2 text-sm text-center",children:i.is_list?(0,a.jsx)(ei.default,{onRemove:g,...b,...c,multiple:!0,accept:v,children:(0,a.jsx)(u.ZP,{loading:f,icon:(0,a.jsx)(eo.Z,{}),children:s("Upload_Data")})}):(0,a.jsx)(ei.default,{onRemove:g,...b,...c,multiple:!1,accept:v,children:(0,a.jsx)(u.ZP,{loading:f,icon:(0,a.jsx)(eo.Z,{}),children:s("Upload_Data")})})})},{Password:eu}=o.default,ep=e=>{var t;let l=(0,D.It)((null===(t=e.ui)||void 0===t?void 0:t.attr)||{});return(0,a.jsx)(eu,{...l,placeholder:"input password"})},em=e=>{var t;let l=(0,D.It)((null===(t=e.ui)||void 0===t?void 0:t.attr)||{});return(0,a.jsx)(o.default,{...l,className:"w-full",placeholder:"please input",allowClear:!0})};var ef=e=>{let{node:t,paramData:l,label:n,index:r}=e;return"resource"===l.category?(0,a.jsx)(T,{node:t,data:l,type:"target",label:n,index:r}):"common"===l.category?(null==l?void 0:l.ui)?function(e){var t;let{refresh_depends:l,ui_type:n}=e.ui,r=null!==(t=e.value)&&void 0!==t?t:e.default;return(0,a.jsx)(N.default.Item,{className:"mb-2",initialValue:r,name:e.name,rules:[{required:!e.optional}],label:(0,a.jsx)("span",{className:"text-neutral-500",children:e.label}),...l&&{dependencies:l},...e.description&&{tooltip:{title:e.description,icon:(0,a.jsx)(V.Z,{})}},children:function(e,t){switch(e){case"select":return L(t);case"cascader":return G(t);case"checkbox":return J(t);case"radio":return H(t);case"input":return B(t);case"text_area":return X(t);case"slider":return Q(t);case"date_picker":return R(t);case"time_picker":return et(t);case"tree_select":return ea(t);case"password":return ep(t);case"upload":return ec({data:t});case"variables":return em(t);case"code_editor":return es(t);default:return null}}(n,e)})}(l):function(e){var t,l;let n=null!==(t=e.value)&&void 0!==t?t:e.default;switch(e.type_name){case"int":case"float":return(0,a.jsx)(N.default.Item,{className:"mb-2 text-sm",name:e.name,initialValue:n,rules:[{required:!e.optional}],label:(0,a.jsx)("span",{className:"text-neutral-500",children:e.label}),tooltip:e.description?{title:e.description,icon:(0,a.jsx)(V.Z,{})}:"",children:(0,a.jsx)(Z.Z,{className:"w-full nodrag"})});case"str":return(0,a.jsx)(N.default.Item,{className:"mb-2 text-sm",name:e.name,initialValue:n,rules:[{required:!e.optional}],label:(0,a.jsx)("span",{className:"text-neutral-500",children:e.label}),tooltip:e.description?{title:e.description,icon:(0,a.jsx)(V.Z,{})}:"",children:(null===(l=e.options)||void 0===l?void 0:l.length)>0?(0,a.jsx)(k.default,{className:"w-full nodrag",options:e.options.map(e=>({label:e.label,value:e.value}))}):(0,a.jsx)(o.default,{className:"w-full"})});case"bool":return n="True"===(n="False"!==n&&n)||n,(0,a.jsx)(N.default.Item,{className:"mb-2 text-sm",name:e.name,initialValue:n,rules:[{required:!e.optional}],label:(0,a.jsx)("span",{className:"text-neutral-500",children:e.label}),tooltip:e.description?{title:e.description,icon:(0,a.jsx)(V.Z,{})}:"",children:(0,a.jsx)(C.Z,{className:"ml-2"})})}}(l):void 0},ex=l(57132),ev=l(48689),eh=e=>{let{children:t,className:l}=e;return(0,a.jsx)("div",{className:A()("flex justify-center items-center w-8 h-8 rounded-full dark:bg-zinc-700 hover:bg-stone-200 dark:hover:bg-zinc-900",l),children:t})},ej=l(96486);function eg(e){let{label:t}=e;return(0,a.jsx)("div",{className:"w-full h-8 align-middle font-semibold",children:t})}var eb=l(12906),ew=l(57546),ey=l(58638),e_=l(60219),eN=l(26855),eZ=l(42075),ek=l(96074),eC=l(39332),eI=l(24885),eP=l(59819);l(4583);let{TextArea:eS}=o.default,eF=e=>{let{reactFlow:t,isSaveFlowModalOpen:l,flowInfo:r,setIsSaveFlowModalOpen:s}=e,[i,d]=(0,p.useState)(!0),{t:c}=(0,m.$G)(),f=(0,eC.useSearchParams)(),x=(null==f?void 0:f.get("id"))||"",[v]=N.default.useForm(),[h,j]=I.ZP.useMessage();async function g(){let{name:e,label:l,description:a="",editable:r=!1,state:o="deployed"}=v.getFieldsValue();console.log(v.getFieldsValue());let i=(0,D.Wf)(t.toObject());if(x){let[,,t]=await (0,n.Vx)((0,n.ao)(x,{name:e,label:l,description:a,editable:r,uid:x,flow_data:i,state:o}));(null==t?void 0:t.success)?h.success(c("save_flow_success")):(null==t?void 0:t.err_msg)&&h.error(null==t?void 0:t.err_msg)}else{let[t,s]=await (0,n.Vx)((0,n.zd)({name:e,label:l,description:a,editable:r,flow_data:i,state:o}));if(null==s?void 0:s.uid){h.success(c("save_flow_success"));let e=window.history;e.pushState(null,"","/flow/canvas?id=".concat(s.uid))}}s(!1)}return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(en.default,{title:c("flow_modal_title"),open:l,onCancel:()=>{s(!1)},cancelButtonProps:{className:"hidden"},okButtonProps:{className:"hidden"},children:(0,a.jsxs)(N.default,{name:"flow_form",form:v,labelCol:{span:6},wrapperCol:{span:16},style:{maxWidth:600},initialValues:{remember:!0},onFinish:g,autoComplete:"off",children:[(0,a.jsx)(N.default.Item,{label:"Title",name:"label",initialValue:null==r?void 0:r.label,rules:[{required:!0,message:"Please input flow title!"}],children:(0,a.jsx)(o.default,{onChange:function(e){let t=e.target.value,l=t.replace(/\s+/g,"_").replace(/[^a-z0-9_-]/g,"").toLowerCase();v.setFieldsValue({name:l})}})}),(0,a.jsx)(N.default.Item,{label:"Name",name:"name",initialValue:null==r?void 0:r.name,rules:[{required:!0,message:"Please input flow name!"},()=>({validator:(e,t)=>/^[a-zA-Z0-9_\-]+$/.test(t)?Promise.resolve():Promise.reject("Can only contain numbers, letters, underscores, and dashes")})],children:(0,a.jsx)(o.default,{})}),(0,a.jsx)(N.default.Item,{label:"Description",initialValue:null==r?void 0:r.description,name:"description",children:(0,a.jsx)(eS,{rows:3})}),(0,a.jsx)(N.default.Item,{label:"Editable",name:"editable",initialValue:null==r?void 0:r.editable,valuePropName:"checked",children:(0,a.jsx)(C.Z,{})}),(0,a.jsx)(N.default.Item,{hidden:!0,name:"state",children:(0,a.jsx)(o.default,{})}),(0,a.jsx)(N.default.Item,{label:"Deploy",children:(0,a.jsx)(C.Z,{defaultChecked:(null==r?void 0:r.state)==="deployed"||(null==r?void 0:r.state)==="running",checked:i,onChange:e=>{let t=e.target.checked;v.setFieldValue("state",t?"deployed":"developing"),d(t)}})}),(0,a.jsx)(N.default.Item,{wrapperCol:{offset:14,span:8},children:(0,a.jsxs)(eZ.Z,{children:[(0,a.jsx)(u.ZP,{htmlType:"button",onClick:()=>{s(!1)},children:"Cancel"}),(0,a.jsx)(u.ZP,{type:"primary",htmlType:"submit",children:"Submit"})]})})]})}),j]})},eE=e=>{let{reactFlow:t,flowInfo:l,isExportFlowModalOpen:r,setIsExportFlowModalOpen:s}=e,{t:i}=(0,m.$G)(),[d]=N.default.useForm(),[c,p]=I.ZP.useMessage(),f=async e=>{let l=t.toObject(),a=new Blob([JSON.stringify(l)],{type:"text/plain;charset=utf-8"}),r=URL.createObjectURL(a),o=document.createElement("a");o.href=r,o.download=e.file_name||"flow.json",o.click();let[,,d]=await (0,n.Vx)((0,n.M6)(e));(null==d?void 0:d.success)?c.success(i("Export_Flow_Success")):(null==d?void 0:d.err_msg)&&c.error(null==d?void 0:d.err_msg),s(!1)};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(en.default,{title:"Export Flow",open:r,onCancel:()=>s(!1),footer:null,children:(0,a.jsxs)(N.default,{form:d,labelCol:{span:6},wrapperCol:{span:16},initialValues:{export_type:"json",format:"file",file_name:"flow.json",uid:null==l?void 0:l.uid},onFinish:f,children:[(0,a.jsx)(N.default.Item,{label:"File Name",name:"file_name",rules:[{required:!0,message:"Please input file name!"}],children:(0,a.jsx)(o.default,{placeholder:"file.json"})}),(0,a.jsx)(N.default.Item,{label:"Export Type",name:"export_type",children:(0,a.jsxs)(K.ZP.Group,{children:[(0,a.jsx)(K.ZP,{value:"json",children:"JSON"}),(0,a.jsx)(K.ZP,{value:"dbgpts",children:"DBGPTS"})]})}),(0,a.jsx)(N.default.Item,{label:"Format",name:"format",children:(0,a.jsxs)(K.ZP.Group,{children:[(0,a.jsx)(K.ZP,{value:"file",children:"File"}),(0,a.jsx)(K.ZP,{value:"json",children:"JSON"})]})}),(0,a.jsx)(N.default.Item,{hidden:!0,name:"uid",children:(0,a.jsx)(o.default,{})}),(0,a.jsx)(N.default.Item,{wrapperCol:{offset:14,span:8},children:(0,a.jsxs)(eZ.Z,{children:[(0,a.jsx)(u.ZP,{onClick:()=>s(!1),children:"Cancel"}),(0,a.jsx)(u.ZP,{type:"primary",htmlType:"submit",children:"Export"})]})})]})}),p]})};var ez=l(96496),eV=l(36609);let eO=e=>{let{setNodes:t,setEdges:l,isImportModalOpen:r,setIsImportFlowModalOpen:s}=e,[o]=N.default.useForm(),[i,d]=I.ZP.useMessage(),c=async e=>{var t;console.log(e),e.file=null===(t=e.file)||void 0===t?void 0:t[0];let[,,l]=await (0,n.Vx)((0,n._Y)(e));(null==l?void 0:l.success)?i.success((0,eV.t)("Export_Flow_Success")):(null==l?void 0:l.err_msg)&&i.error(null==l?void 0:l.err_msg),s(!1)};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(en.default,{title:"Import Flow",open:r,onCancel:()=>s(!1),footer:null,children:(0,a.jsxs)(N.default,{form:o,labelCol:{span:6},wrapperCol:{span:16},onFinish:c,children:[(0,a.jsx)(N.default.Item,{name:"file",label:"File",valuePropName:"fileList",getValueFromEvent:e=>Array.isArray(e)?e:e&&e.fileList,rules:[{required:!0,message:"Please upload a file"}],children:(0,a.jsx)(ei.default,{accept:".json,.zip",beforeUpload:()=>!1,maxCount:1,children:(0,a.jsx)(u.ZP,{icon:(0,a.jsx)(ez.Z,{}),children:"Click to Upload"})})}),(0,a.jsx)(N.default.Item,{label:"save flow",name:"save_flow",valuePropName:"checked",children:(0,a.jsx)(C.Z,{})}),(0,a.jsx)(N.default.Item,{wrapperCol:{offset:14,span:8},children:(0,a.jsxs)(eZ.Z,{children:[(0,a.jsx)(u.ZP,{onClick:()=>s(!1),children:"Cancel"}),(0,a.jsx)(u.ZP,{type:"primary",htmlType:"submit",children:"Import"})]})})]})}),d]})},eA={customNode:e=>{let{data:t}=e,{inputs:l,outputs:r,parameters:s,flow_type:o}=t,[i,c]=(0,p.useState)(!1),u=(0,E._K)(),[m]=N.default.useForm();async function f(e,l){let a=s.filter(t=>{var l;let{ui:a}=t;return null==a?void 0:null===(l=a.refresh_depends)||void 0===l?void 0:l.includes(e)});(null==a?void 0:a.length)!==0&&a.forEach(async a=>{let r={id:(0,D._g)(null==t?void 0:t.id),type_name:t.type_name,type_cls:t.type_cls,flow_type:"operator",refresh:[{name:a.name,depends:[{name:e,value:l,has_value:!0}]}]},[s,o]=await (0,n.Vx)((0,n.ks)(r));o&&u.setNodes(e=>e.map(e=>e.id===t.id?{...e,data:{...e.data,parameters:o.parameters}}:e))})}return(0,a.jsx)(d.Z,{placement:"rightTop",trigger:["hover"],content:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(eh,{className:"hover:text-blue-500",children:(0,a.jsx)(ex.Z,{className:"h-full text-lg cursor-pointer",onClick:function(e){e.preventDefault(),e.stopPropagation();let l=u.getNodes(),a=l.find(e=>e.id===t.id);if(a){let e=(0,D.VZ)(a,l),t=(0,ej.cloneDeep)(a),n={...t,id:e,position:{x:t.position.x+400,y:t.position.y},positionAbsolute:{x:t.positionAbsolute.x+400,y:t.positionAbsolute.y},data:{...t.data,id:e},selected:!1};u.setNodes(e=>[...e,n])}}})}),(0,a.jsx)(eh,{className:"mt-2 hover:text-red-500",children:(0,a.jsx)(ev.Z,{className:"h-full text-lg cursor-pointer",onClick:function(e){e.preventDefault(),e.stopPropagation(),u.setNodes(e=>e.filter(e=>e.id!==t.id)),u.setEdges(e=>e.filter(e=>e.source!==t.id&&e.target!==t.id))}})}),(0,a.jsx)(eh,{className:"mt-2",children:(0,a.jsx)(F.Z,{title:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("p",{className:"font-bold",children:t.label}),(0,a.jsx)("p",{children:t.description})]}),placement:"right",children:(0,a.jsx)(V.Z,{className:"h-full text-lg cursor-pointer"})})})]}),children:(0,a.jsxs)("div",{className:A()("w-80 h-auto rounded-xl shadow-md px-2 py-4 border bg-white dark:bg-zinc-800 cursor-grab flex flex-col space-y-2 text-sm",{"border-blue-500":t.selected||i,"border-stone-400 dark:border-white":!t.selected&&!i,"border-dashed":"operator"!==o,"border-red-600":t.invalid}),onMouseEnter:function(){c(!0)},onMouseLeave:function(){c(!1)},children:[(0,a.jsxs)("div",{className:"flex flex-row items-center",children:[(0,a.jsx)(_(),{src:"/icons/node/vis.png",width:24,height:24,alt:""}),(0,a.jsx)("p",{className:"ml-2 text-lg font-bold text-ellipsis overflow-hidden whitespace-nowrap",children:t.label})]}),(null==l?void 0:l.length)>0&&(0,a.jsxs)("div",{className:"bg-zinc-100 dark:bg-zinc-700 rounded p-2",children:[(0,a.jsx)(eg,{label:"Inputs"}),(0,a.jsx)("div",{className:"flex flex-col space-y-2",children:null==l?void 0:l.map((e,l)=>(0,a.jsx)(T,{node:t,data:e,type:"target",label:"inputs",index:l},"".concat(t.id,"_input_").concat(l)))})]}),(null==s?void 0:s.length)>0&&(0,a.jsxs)("div",{className:"bg-zinc-100 dark:bg-zinc-700 rounded p-2",children:[(0,a.jsx)(eg,{label:"Parameters"}),(0,a.jsx)(N.default,{form:m,layout:"vertical",onValuesChange:function(e,t){let[l,a]=Object.entries(e)[0];s.forEach(e=>{e.name===l&&(e.value=a)}),a&&f(l,a)},className:"flex flex-col space-y-3 text-neutral-500",children:null==s?void 0:s.map((e,l)=>(0,a.jsx)(ef,{node:t,paramData:e,label:"parameters",index:l},"".concat(t.id,"_param_").concat(l)))})]}),(null==r?void 0:r.length)>0&&(0,a.jsxs)("div",{className:"bg-zinc-100 dark:bg-zinc-700 rounded p-2",children:[(0,a.jsx)(eg,{label:"Outputs"}),"operator"===o?(0,a.jsx)("div",{className:"flex flex-col space-y-3",children:r.map((e,l)=>(0,a.jsx)(T,{node:t,data:e,type:"source",label:"outputs",index:l},"".concat(t.id,"_output_").concat(l)))}):"resource"===o&&(0,a.jsx)(T,{node:t,data:t,type:"source",label:"outputs",index:0},"".concat(t.id,"_output_0"))]})]})})}},eT={buttonedge:w.Z},eD=()=>{let{t:e}=(0,m.$G)(),t=(0,eC.useSearchParams)(),l=(null==t?void 0:t.get("id"))||"",s=(0,E._K)(),[o,i]=(0,p.useState)(!1),[d,c,u]=(0,E.Rr)([]),[f,x,v]=(0,E.ll)([]),h=(0,p.useRef)(null),[j,g]=(0,p.useState)(),[w,y]=(0,p.useState)(!1),[_,N]=(0,p.useState)(!1),[Z,k]=(0,p.useState)(!1);async function C(){i(!0);let[e,t]=await (0,n.Vx)((0,n._d)(l));if(t){let e=(0,D.z5)(t.flow_data);g(t),c(e.nodes),x(e.edges)}i(!1)}(0,p.useEffect)(()=>{l&&C()},[l]),(0,p.useEffect)(()=>{let e=e=>{e.returnValue=I.ZP};return window.addEventListener("beforeunload",e),()=>{window.removeEventListener("beforeunload",e)}},[]);let P=(0,p.useCallback)(e=>{e.preventDefault();let t=h.current.getBoundingClientRect(),l=e.dataTransfer.getData("application/reactflow");if(!l||void 0===l)return;let a=JSON.parse(l),n=s.screenToFlowPosition({x:e.clientX-t.left,y:e.clientY-t.top}),r=(0,D.VZ)(a,s.getNodes());a.id=r;let o={id:r,position:n,type:"customNode",data:a};c(e=>e.concat(o).map(e=>(e.id===o.id?e.data={...e.data,selected:!0}:e.data={...e.data,selected:!1},e)))},[s]),S=(0,p.useCallback)(e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"},[]);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.Z,{visible:o}),(0,a.jsx)(eZ.Z,{className:"my-2 mx-4 flex flex-row justify-end",children:[{title:"import",icon:(0,a.jsx)(ew.Z,{className:"block text-xl",onClick:function(){k(!0)}})},{title:"export",icon:(0,a.jsx)(ey.Z,{className:"block text-xl",onClick:function(){N(!0)}})},{title:"save",icon:(0,a.jsx)(e_.Z,{className:"block text-xl",onClick:function(){let e=s.toObject(),[t,l,n]=(0,D.Rv)(e);if(!t&&n)return c(e=>e.map(e=>(e.id===(null==l?void 0:l.id)?e.data={...e.data,invalid:!0}:e.data={...e.data,invalid:!1},e))),eN.ZP.error({message:"Error",description:n,icon:(0,a.jsx)(eb.Z,{className:"text-red-600"})});y(!0)}})}].map(e=>{let{title:t,icon:l}=e;return(0,a.jsx)(F.Z,{title:t,className:"w-8 h-8 rounded-md bg-stone-300 dark:bg-zinc-700 dark:text-zinc-200 hover:text-blue-500 dark:hover:text-zinc-100",children:l},t)})}),(0,a.jsx)(ek.Z,{className:"mt-0 mb-0"}),(0,a.jsx)("div",{className:"h-[calc(100vh-60px)] w-full",ref:h,children:(0,a.jsxs)(E.x$,{nodes:d,edges:f,nodeTypes:eA,edgeTypes:eT,onNodesChange:u,onEdgesChange:v,onNodeClick:function(e,t){s.setNodes(e=>e.map(e=>(e.id===t.id?e.data={...e.data,selected:!0}:e.data={...e.data,selected:!1},e)))},onConnect:function(e){let t={...e,type:"buttonedge",id:"".concat(e.source,"|").concat(e.target)};x(e=>(0,E.Z_)(t,e))},onDrop:P,onDragOver:S,minZoom:.1,fitView:!0,deleteKeyCode:["Backspace","Delete"],children:[(0,a.jsx)(eI.Z,{className:"flex flex-row items-center",position:"bottom-center"}),(0,a.jsx)(eP.A,{color:"#aaa",gap:16}),(0,a.jsx)(b,{})]})}),(0,a.jsx)(eF,{reactFlow:s,flowInfo:j,isSaveFlowModalOpen:w,setIsSaveFlowModalOpen:y}),(0,a.jsx)(eE,{reactFlow:s,flowInfo:j,isExportFlowModalOpen:_,setIsExportFlowModalOpen:N}),(0,a.jsx)(eO,{setNodes:c,setEdges:x,isImportModalOpen:Z,setIsImportFlowModalOpen:k})]})};function eL(){return(0,a.jsx)(E.tV,{children:(0,a.jsx)(eD,{})})}},67919:function(e,t,l){"use strict";l.d(t,{It:function(){return i},Rv:function(){return o},VZ:function(){return a},Wf:function(){return r},_g:function(){return n},z5:function(){return s}});let a=(e,t)=>{let l=0;return t.forEach(t=>{t.data.name===e.name&&l++}),"".concat(e.id,"_").concat(l)},n=e=>e.replace(/_\d+$/,""),r=e=>{let{nodes:t,edges:l,...a}=e,n=t.map(e=>{let{positionAbsolute:t,...l}=e;return{position_absolute:t,...l}}),r=l.map(e=>{let{sourceHandle:t,targetHandle:l,...a}=e;return{source_handle:t,target_handle:l,...a}});return{nodes:n,edges:r,...a}},s=e=>{let{nodes:t,edges:l,...a}=e,n=t.map(e=>{let{position_absolute:t,...l}=e;return{positionAbsolute:t,...l}}),r=l.map(e=>{let{source_handle:t,target_handle:l,...a}=e;return{sourceHandle:t,targetHandle:l,...a}});return{nodes:n,edges:r,...a}},o=e=>{let{nodes:t,edges:l}=e,a=[!0,t[0],""];e:for(let e=0;e<t.length;e++){let n=t[e].data,{inputs:r=[],parameters:s=[]}=n;for(let s=0;s<r.length;s++)if(!l.some(l=>l.targetHandle==="".concat(t[e].id,"|inputs|").concat(s))){a=[!1,t[e],"The input ".concat(r[s].type_name," of node ").concat(n.label," is required")];break e}for(let r=0;r<s.length;r++){let o=s[r];if(o.optional||"resource"!==o.category||l.some(l=>l.targetHandle==="".concat(t[e].id,"|parameters|").concat(r))){if(!o.optional&&"common"===o.category&&(void 0===o.value||null===o.value)){a=[!1,t[e],"The parameter ".concat(o.type_name," of node ").concat(n.label," is required")];break e}}else{a=[!1,t[e],"The parameter ".concat(o.type_name," of node ").concat(n.label," is required")];break e}}}return a},i=e=>(function e(t){if(Array.isArray(t))return t.map(t=>e(t));if(t&&"object"==typeof t&&!Array.isArray(t)){let l={};for(let a in t)if(t.hasOwnProperty(a)){let n=a.replace(/_([a-z])/g,(e,t)=>t.toUpperCase());l[n]=e(t[a])}return l}return t})(e)}},function(e){e.O(0,[3662,8241,2648,3791,2913,7075,5081,4041,9859,3799,9671,4567,6386,2797,7434,1946,4287,3764,9924,5085,2047,9774,2888,179],function(){return e(e.s=94617)}),_N_E=e.O()}]);