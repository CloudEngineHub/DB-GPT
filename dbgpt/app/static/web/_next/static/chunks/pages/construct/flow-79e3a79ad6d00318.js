(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[657],{99051:function(e,t,l){(window.__NEXT_P=window.__NEXT_P||[]).push(["/construct/flow",function(){return l(32202)}])},91085:function(e,t,l){"use strict";var a=l(85893),n=l(32983),s=l(14726),i=l(93967),c=l.n(i),r=l(67421);t.Z=function(e){let{className:t,error:l,description:i,refresh:o}=e,{t:d}=(0,r.$G)();return(0,a.jsx)(n.Z,{image:"/empty.png",imageStyle:{width:320,height:196,margin:"0 auto",maxWidth:"100%",maxHeight:"100%"},className:c()("flex items-center justify-center flex-col h-full w-full",t),description:l?(0,a.jsx)(s.ZP,{type:"primary",onClick:o,children:d("try_again")}):null!=i?i:d("no_data")})}},48218:function(e,t,l){"use strict";var a=l(85893),n=l(82353),s=l(16165),i=l(67294);t.Z=e=>{let{width:t,height:l,scene:c}=e,r=(0,i.useCallback)(()=>{switch(c){case"chat_knowledge":return n.je;case"chat_with_db_execute":return n.zM;case"chat_excel":return n.DL;case"chat_with_db_qa":case"chat_dba":return n.RD;case"chat_dashboard":return n.In;case"chat_agent":return n.si;case"chat_normal":return n.O7;default:return}},[c]);return(0,a.jsx)(s.Z,{className:"w-".concat(t||7," h-").concat(l||7),component:r()})}},91467:function(e,t,l){"use strict";l.d(t,{TH:function(){return x},ZS:function(){return f}});var a=l(85893),n=l(89705),s=l(83062),i=l(96074),c=l(7075),r=l(85418),o=l(93967),d=l.n(o),u=l(36609),h=l(25675),m=l.n(h);l(67294);var p=l(48218);l(11873);let x=e=>{let{onClick:t,Icon:l="/pictures/card_chat.png",text:n=(0,u.t)("start_chat")}=e;return"string"==typeof l&&(l=(0,a.jsx)(m(),{src:l,alt:l,width:17,height:15})),(0,a.jsxs)("div",{className:"flex items-center gap-1 text-default",onClick:e=>{e.stopPropagation(),t&&t()},children:[l,(0,a.jsx)("span",{children:n})]})},f=e=>{let{menu:t}=e;return(0,a.jsx)(r.Z,{menu:t,getPopupContainer:e=>e.parentNode,placement:"bottomRight",autoAdjustOverflow:!1,children:(0,a.jsx)(n.Z,{className:"p-2 hover:bg-white hover:dark:bg-black rounded-md"})})};t.ZP=e=>{let{RightTop:t,Tags:l,LeftBottom:n,RightBottom:r,onClick:o,rightTopHover:u=!0,logo:h,name:x,description:f,className:g,scene:j,code:b}=e;return"string"==typeof f&&(f=(0,a.jsx)("p",{className:"line-clamp-2 relative bottom-4 text-ellipsis min-h-[42px] text-sm text-[#525964] dark:text-[rgba(255,255,255,0.65)]",children:f})),(0,a.jsx)("div",{className:d()("hover-underline-gradient flex justify-center mt-6 relative group w-1/3 px-2 mb-6",g),children:(0,a.jsxs)("div",{onClick:o,className:"backdrop-filter backdrop-blur-lg cursor-pointer  bg-white bg-opacity-70 border-2 border-white rounded-lg shadow p-4 relative w-full h-full dark:border-[#6f7f95] dark:bg-[#6f7f95] dark:bg-opacity-60",children:[(0,a.jsxs)("div",{className:"flex items-end relative bottom-8 justify-between w-full",children:[(0,a.jsxs)("div",{className:"flex items-end gap-4 w-11/12  flex-1",children:[(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm w-14 h-14 flex items-center p-3",children:j?(0,a.jsx)(p.Z,{scene:j,width:14,height:14}):h&&(0,a.jsx)(m(),{src:h,width:44,height:44,alt:x,className:"w-8 min-w-8 rounded-full max-w-none"})}),(0,a.jsx)("div",{className:"flex-1",children:x.length>6?(0,a.jsx)(s.Z,{title:x,children:(0,a.jsx)("span",{className:"line-clamp-1 text-ellipsis font-semibold text-base",style:{maxWidth:"60%"},children:x})}):(0,a.jsx)("span",{className:"line-clamp-1 text-ellipsis font-semibold text-base",style:{maxWidth:"60%"},children:x})})]}),(0,a.jsx)("span",{className:d()("shrink-0",{hidden:u,"group-hover:block":u}),onClick:e=>{e.stopPropagation()},children:t})]}),f,(0,a.jsx)("div",{className:"relative bottom-2",children:l}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("div",{children:n}),(0,a.jsx)("div",{children:r})]}),b&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i.Z,{className:"my-3"}),(0,a.jsx)(c.Z.Text,{copyable:!0,className:"absolute bottom-1 right-4 text-xs text-gray-500",children:b})]})]})})}},1771:function(e,t,l){"use strict";var a=l(85893);l(67294);var n=l(28459),s=l(92398),i=l(36609),c=l(41156),r=l(9641),o=l(16165),d=l(9020),u=l(92962),h=l(38545),m=l(50067),p=l(82353),x=l(11163);l(53878),t.Z=function(e){let{children:t}=e,l=[{key:"app",name:(0,i.t)("App"),path:"/app",icon:(0,a.jsx)(c.Z,{})},{key:"flow",name:(0,i.t)("awel_flow"),icon:(0,a.jsx)(r.Z,{}),path:"/flow"},{key:"models",name:(0,i.t)("model_manage"),path:"/models",icon:(0,a.jsx)(o.Z,{component:p.IN})},{key:"database",name:(0,i.t)("Database"),icon:(0,a.jsx)(d.Z,{}),path:"/database"},{key:"knowledge",name:(0,i.t)("Knowledge_Space"),icon:(0,a.jsx)(u.Z,{}),path:"/knowledge"},{key:"prompt",name:(0,i.t)("Prompt"),icon:(0,a.jsx)(h.Z,{}),path:"/prompt"},{key:"dbgpts",name:(0,i.t)("dbgpts_community"),path:"/dbgpts",icon:(0,a.jsx)(m.Z,{})}],f=(0,x.useRouter)(),g=f.pathname.split("/")[2];return window.matchMedia("(prefers-color-scheme: dark)").matches,(0,a.jsx)("div",{className:"flex flex-col h-full w-full  dark:bg-gradient-dark bg-gradient-light bg-cover bg-center",children:(0,a.jsx)(n.ZP,{theme:{components:{Button:{},Segmented:{itemSelectedBg:"#2867f5",itemSelectedColor:"white"}}},children:(0,a.jsx)(s.Z,{activeKey:g,items:l.map(e=>({key:e.key,label:e.name,children:t,icon:e.icon})),onTabClick:e=>{f.push("/construct/".concat(e))}})})})}},32202:function(e,t,l){"use strict";l.r(t);var a=l(85893),n=l(91467),s=l(1771),i=l(41468),c=l(76212),r=l(91085),o=l(24969),d=l(65654),u=l(45360),h=l(99859),m=l(75081),p=l(14726),x=l(86738),f=l(66309),g=l(85576),j=l(34041),b=l(69677),v=l(84567),w=l(36609),_=l(96486),y=l(30381),k=l.n(y),N=l(11163),Z=l(97334),C=l.n(Z),S=l(67294),P=l(67421);t.default=function(){let e=(0,N.useRouter)(),{model:t,currentDialogInfo:l,setCurrentDialogInfo:y}=(0,S.useContext)(i.p),[Z,E]=u.ZP.useMessage(),[T,R]=(0,S.useState)([]),[B,H]=(0,S.useState)(!1),[W,V]=(0,S.useState)(),[F,I]=(0,S.useState)([]),L=(0,S.useRef)(),[q,D]=(0,S.useState)(!1),[A,O]=(0,S.useState)(!1),[z,G]=(0,S.useState)(!1),[K]=h.default.useForm(),M=(0,S.useRef)(),X=(0,S.useRef)(null),{run:$,loading:J,refresh:Q}=(0,d.Z)(async e=>await (0,c.Vx)((0,c.Wf)({page:1,page_size:12,...e})),{cacheKey:"query-flow-list",onSuccess:e=>{let[,t]=e;R(e=>(0,_.concat)([...e],(null==t?void 0:t.items)||[])),M.current={current_page:(null==t?void 0:t.page)||1,total_count:(null==t?void 0:t.total_count)||0,total_page:(null==t?void 0:t.total_pages)||0}},throttleWait:300}),{i18n:U}=(0,P.$G)(),Y=(0,S.useCallback)(()=>{let e=M.current;e&&e.current_page<e.total_page&&($({page:e.current_page+1}),e.current_page=e.current_page+1)},[$]),ee=(0,_.debounce)(e=>{let t=e.target;t.scrollHeight-t.scrollTop<=t.clientHeight+200&&Y()},200);(0,S.useEffect)(()=>{if(J)return;let e=X.current;return e&&(null==e||e.addEventListener("scroll",ee),e.scrollHeight===e.clientHeight&&Y()),()=>{e&&(null==e||e.removeEventListener("scroll",ee))}},[J,ee,Y]);let et=async a=>{let[,n]=await (0,c.Vx)((0,c.sW)({chat_mode:"chat_agent"}));if(n){null==y||y({...l,app_code:""});let s=C().stringify({scene:"chat_flow",id:n.conv_uid,model:t,select_param:a.uid});e.push("/chat?".concat(s))}};async function el(e){let[,,t]=await (0,c.Vx)((0,c.Jq)(e.uid));(null==t?void 0:t.success)&&R(t=>t.filter(t=>t.uid!==e.uid))}(0,S.useEffect)(()=>{var e;(null==W?void 0:null===(e=W.admins)||void 0===e?void 0:e.length)?I(null==W?void 0:W.admins):I([])},[W]);let{run:ea,loading:en}=(0,d.Z)(async e=>await (0,c.Vx)((0,c.jt)({uid:(null==W?void 0:W.uid)||"",admins:e})),{manual:!0,onSuccess:e=>{let[t]=e;t?u.ZP.error("更新失败"):u.ZP.success("更新成功")}}),es=e=>{L.current=e,K.setFieldValue("label","".concat(e.label," Copy")),K.setFieldValue("name","".concat(e.name,"_copy")),O(!0),G(!0),D(!0)},ei=async e=>{if(!L.current)return;let{source:t,uid:l,dag_id:a,gmt_created:n,gmt_modified:s,state:i,...r}=L.current,o={...r,editable:z,state:A?"deployed":"developing",...e},[d]=await (0,c.Vx)((0,c.zd)(o));d||(Z.success((0,w.t)("save_flow_success")),D(!1),$({}))},ec=async e=>{I(e),await ea(e),await Q()};return(0,a.jsxs)(s.Z,{children:[(0,a.jsx)(m.Z,{spinning:J,children:(0,a.jsxs)("div",{className:"relative h-screen w-full p-4 md:p-6 overflow-y-auto",ref:X,children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsx)("div",{className:"flex items-center gap-4"}),(0,a.jsx)("div",{className:"flex items-center gap-4",children:(0,a.jsx)(p.ZP,{className:"border-none text-white bg-button-gradient",icon:(0,a.jsx)(o.Z,{}),onClick:()=>{e.push("/construct/flow/canvas")},children:(0,w.t)("create_flow")})})]}),(0,a.jsxs)("div",{className:"flex flex-wrap mx-[-8px] pb-12 justify-start items-stretch",children:[T.map(t=>(0,a.jsx)(n.ZP,{description:t.description,name:t.name,logo:"/pictures/flow.png",onClick:()=>{e.push("/construct/flow/canvas?id="+t.uid)},RightTop:(0,a.jsx)(n.ZS,{menu:{items:[{key:"copy",label:(0,a.jsx)("span",{onClick:()=>{es(t)},children:(0,w.t)("Copy_Btn")})},{key:"del",label:(0,a.jsx)(x.Z,{title:"Are you sure to delete this flow?",onConfirm:()=>el(t),children:(0,a.jsx)("span",{className:"text-red-400",children:(0,w.t)("Delete_Btn")})})}]}}),rightTopHover:!1,Tags:(0,a.jsxs)("div",{children:[(0,a.jsx)(f.Z,{color:"DBGPT-WEB"===t.source?"green":"blue",children:t.source}),(0,a.jsx)(f.Z,{color:t.editable?"green":"gray",children:t.editable?"Editable":"Can not Edit"}),(0,a.jsx)(f.Z,{color:"load_failed"===t.state?"red":"running"===t.state?"green":"blue",children:t.state})]}),LeftBottom:(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("span",{children:null==t?void 0:t.nick_name}),(0,a.jsx)("span",{children:"•"}),(null==t?void 0:t.gmt_modified)&&(0,a.jsx)("span",{children:k()(null==t?void 0:t.gmt_modified).fromNow()+" "+(0,w.t)("update")})]},U.language+"flow"),RightBottom:(0,a.jsx)(n.TH,{onClick:()=>{et(t)},text:(0,w.t)("start_chat")})},t.uid)),0===T.length&&(0,a.jsx)(r.Z,{description:"No flow found"})]})]})}),(0,a.jsx)(g.default,{title:"权限管理",open:B,onCancel:()=>H(!1),footer:null,children:(0,a.jsxs)("div",{className:"py-4",children:[(0,a.jsx)("div",{className:"mb-1",children:"管理员（工号，去前缀0）："}),(0,a.jsx)(j.default,{mode:"tags",value:F,style:{width:"100%"},onChange:ec,tokenSeparators:[","],options:null==F?void 0:F.map(e=>({label:e,value:e})),loading:en})]})}),(0,a.jsx)(g.default,{open:q,title:"Copy AWEL Flow",onCancel:()=>{D(!1)},footer:!1,children:(0,a.jsxs)(h.default,{form:K,onFinish:ei,className:"mt-6",children:[(0,a.jsx)(h.default.Item,{name:"name",label:"Name",rules:[{required:!0}],children:(0,a.jsx)(b.default,{})}),(0,a.jsx)(h.default.Item,{name:"label",label:"Label",rules:[{required:!0}],children:(0,a.jsx)(b.default,{})}),(0,a.jsx)(h.default.Item,{label:"editable",children:(0,a.jsx)(v.Z,{value:z,checked:z,onChange:e=>{let t=e.target.checked;G(t)}})}),(0,a.jsx)(h.default.Item,{label:"deploy",children:(0,a.jsx)(v.Z,{value:A,checked:A,onChange:e=>{let t=e.target.checked;O(t)}})}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsx)(p.ZP,{type:"primary",htmlType:"submit",children:(0,w.t)("Submit")})})]})})]})}},11873:function(){},53878:function(){}},function(e){e.O(0,[3662,2648,3791,2913,8791,7075,5081,5418,4041,9859,2398,4567,4929,9774,2888,179],function(){return e(e.s=99051)}),_N_E=e.O()}]);