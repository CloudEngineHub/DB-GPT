(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4158],{57954:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/construct/prompt/[type]",function(){return t(48039)}])},89833:function(e,a,t){"use strict";var l=t(85893),s=t(19284),n=t(25675),r=t.n(n),o=t(67294);a.Z=(0,o.memo)(e=>{let{width:a,height:t,model:n}=e,i=(0,o.useMemo)(()=>{let e=null==n?void 0:n.replaceAll("-","_").split("_")[0],a=Object.keys(s.Me);for(let t=0;t<a.length;t++){let l=a[t];if(null==e?void 0:e.includes(l))return s.Me[l]}return"/models/huggingface.svg"},[n]);return n?(0,l.jsx)(r(),{className:"rounded-full border border-gray-200 object-contain bg-white inline-block",width:a||24,height:t||24,src:i,alt:"llm",priority:!0}):null})},2440:function(e,a,t){"use strict";var l=t(25519);a.Z=()=>{var e;return JSON.parse(null!==(e=localStorage.getItem(l.C9))&&void 0!==e?e:"")}},48039:function(e,a,t){"use strict";t.r(a),t.d(a,{__N_SSG:function(){return q}});var l=t(85893),s=t(89833),n=t(41468),r=t(76212),o=t(2440),i=t(62418),d=t(25519),c=t(6171),u=t(1375),p=t(12576),m=t(63086),f=t(54143),h=t(65654),x=t(71338),g=t(10418),_=t(31418),v=t(99859),j=t(42075),y=t(14726),b=t(4393),N=t(38925),w=t(66184),S=t(79531),Z=t(93967),O=t.n(Z),C=t(10048),E=t(5152),F=t.n(E),k=t(11163),V=t(67294);t(92620);var I=t(97804),A=t.n(I),J=t(83454);let P=F()(()=>t.e(2103).then(t.bind(t,82103)),{loadableGenerated:{webpack:()=>[82103]},ssr:!1}),R=new C.Z,T=F()(()=>Promise.all([t.e(3662),t.e(7034),t.e(5081),t.e(1203),t.e(2850),t.e(4567),t.e(9169),t.e(1980),t.e(7434),t.e(3106),t.e(5265),t.e(2783),t.e(3761),t.e(7582),t.e(9946),t.e(7906),t.e(9071),t.e(3913),t.e(3145)]).then(t.bind(t,11746)),{loadableGenerated:{webpack:()=>[11746]},ssr:!1}),L=[{value:"Agent",label:"AGENT"},{value:"Scene",label:"SCENE"},{value:"Normal",label:"NORMAL"},{value:"Evaluate",label:"EVALUATE"}],M=e=>{let{value:a,onChange:t}=e,s=e=>{isNaN(e)||null==t||t(e)};return(0,l.jsxs)("div",{className:"flex items-center gap-8",children:[(0,l.jsx)(x.Z,{className:"w-40",min:0,max:1,step:.1,onChange:s,value:a}),(0,l.jsx)(g.Z,{className:"w-16",min:0,max:1,step:.1,value:a,onChange:s})]})};var q=!0;a.default=()=>{var e;let a=(0,k.useRouter)(),{type:t=""}=a.query,{modelList:x,model:g,mode:Z}=(0,V.useContext)(n.p),C="dark"===Z?m.R:f.K,{message:E}=_.Z.useApp(),F=(0,o.Z)(),[I,q]=(0,V.useState)(""),[G,U]=(0,V.useState)([]),[H,W]=(0,V.useState)({}),[D,K]=(0,V.useState)([]),[X,z]=(0,V.useState)(!1),[B]=v.default.useForm(),[Y]=v.default.useForm(),[Q]=v.default.useForm(),[$,ee]=(0,V.useState)(),ea=v.default.useWatch("prompt_type",B),et=(0,V.useMemo)(()=>x.map(e=>({value:e,label:(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)(s.Z,{model:e}),(0,l.jsx)("span",{className:"ml-2",children:e})]})})),[x]),el=(0,V.useCallback)(e=>{q(e.text)},[]),{data:es,run:en,loading:er}=(0,h.Z)(async e=>await (0,r.pm)(e),{manual:!0}),{run:eo}=(0,h.Z)(async e=>await (0,r.GU)({prompt_type:ea,target:null!=e?e:""}),{manual:!0,onSuccess:e=>{if(e){let{data:a}=e.data;q(a.template),U(a.input_variables);try{let e=JSON.parse(a.response_format);W(e||{})}catch(e){W({})}}}}),{run:ei,loading:ed}=(0,h.Z)(async e=>"add"===t?await (0,r.Vx)((0,r.Hy)(e)):await (0,r.Vx)((0,r.Fu)(e)),{manual:!0,onSuccess:()=>{E.success("".concat("add"===t?"新增":"更新","成功")),a.replace("/construct/prompt")}}),ec=async()=>{if(X)return;let e=Y.getFieldsValue();if(!Object.values(e).every(e=>!!e)){E.warning("请填写完整的输入参数");return}if(!Q.getFieldValue("user_input")){E.warning("请填写用户输入内容");return}B.validateFields().then(async a=>{let t={sub_chat_scene:"",model:Q.getFieldValue("model"),chat_scene:a.target,prompt_name:a.prompt_name,prompt_type:a.prompt_type,content:I,response_schema:JSON.stringify(H),input_variables:JSON.stringify(G),prompt_language:Q.getFieldValue("prompt_language"),prompt_desc:"",prompt_code:a.prompt_code,temperature:Q.getFieldValue("temperature"),debug_model:Q.getFieldValue("model"),input_values:{...e},user_input:Q.getFieldValue("user_input")},l=[{role:"view",context:""}],s=l.length-1;try{var n,r;z(!0),await (0,u.L)("".concat(null!==(n=J.env.API_BASE_URL)&&void 0!==n?n:"","/prompt/template/debug"),{method:"POST",headers:{"Content-Type":"application/json",[d.gp]:null!==(r=(0,i.n5)())&&void 0!==r?r:""},body:JSON.stringify(t),openWhenHidden:!0,async onopen(e){if(e.ok&&e.headers.get("content-type")===u.a)return},onclose(){z(!1)},onerror(e){throw Error(e)},onmessage:e=>{let a=e.data;if(a){try{a=JSON.parse(a).vis}catch(e){a.replaceAll("\\n","\n")}"[DONE]"===a?z(!1):(null==a?void 0:a.startsWith("[ERROR]"))?(z(!1),l[s].context=null==a?void 0:a.replace("[ERROR]","")):(l[s].context=a,K([...l]))}}})}catch(e){z(!1),l[s].context="Sorry, we meet some error, please try again later",K([...l])}})},{run:eu,loading:ep}=(0,h.Z)(async()=>await (0,r.Gn)({llm_out:D[0].context,prompt_type:B.getFieldValue("prompt_type"),chat_scene:B.getFieldValue("target")}),{manual:!0,onSuccess:e=>{var a,t;(null==e?void 0:null===(a=e.data)||void 0===a?void 0:a.success)?ee({msg:"验证通过",status:"success"}):ee({msg:null==e?void 0:null===(t=e.data)||void 0===t?void 0:t.err_msg,status:"error"})}});(0,V.useEffect)(()=>{g&&Q.setFieldsValue({model:g})},[Q,g]),(0,V.useEffect)(()=>{ea&&en(ea)},[en,ea]);let em=(0,V.useMemo)(()=>{var e,a;return null==es?void 0:null===(e=es.data)||void 0===e?void 0:null===(a=e.data)||void 0===a?void 0:a.map(e=>({...e,value:e.name,label:e.name}))},[es]);return(0,V.useEffect)(()=>{if("edit"===t){var e;let a=JSON.parse(localStorage.getItem("edit_prompt_data")||"{}");U(JSON.parse(null!==(e=a.input_variables)&&void 0!==e?e:"[]")),q(null==a?void 0:a.content),B.setFieldsValue({prompt_type:a.prompt_type,prompt_name:a.prompt_name,prompt_code:a.prompt_code,target:a.chat_scene}),Q.setFieldsValue({model:a.model,prompt_language:a.prompt_language})}},[Q,B,t]),(0,l.jsxs)("div",{className:"flex flex-col w-full h-full justify-between dark:bg-gradient-dark ".concat(A()["prompt-operate-container"]),children:[(0,l.jsxs)("header",{className:"flex items-center justify-between px-6 py-2 h-14 border-b border-[#edeeef]",children:[(0,l.jsxs)(j.Z,{className:"flex items-center",children:[(0,l.jsx)(c.Z,{className:"text-base cursor-pointer hover:text-[#0c75fc]",onClick:()=>{localStorage.removeItem("edit_prompt_data"),a.replace("/construct/prompt")}}),(0,l.jsxs)("span",{className:"font-medium text-sm",children:["add"===t?"新增":"编辑"," Prompt"]})]}),(0,l.jsx)(j.Z,{children:(0,l.jsx)(y.ZP,{type:"primary",onClick:()=>{B.validateFields().then(async e=>{let a={sub_chat_scene:"",model:Q.getFieldValue("model"),chat_scene:e.target,prompt_name:e.prompt_name,prompt_type:e.prompt_type,content:I,response_schema:JSON.stringify(H),input_variables:JSON.stringify(G),prompt_language:Q.getFieldValue("prompt_language"),prompt_desc:"",user_name:F.nick_name,..."edit"===t&&{prompt_code:e.prompt_code}};await ei(a)})},loading:ed,children:"add"===t?"保存":"更新"})})]}),(0,l.jsxs)("section",{className:"flex h-full p-4 gap-4",children:[(0,l.jsxs)("div",{className:"flex flex-col flex-1 h-full overflow-y-auto pb-8 ",children:[(0,l.jsx)(P,{value:I,onChange:el,renderHTML:e=>R.render(e),view:{html:!1,md:!0,menu:!0}}),D.length>0&&(0,l.jsx)(b.Z,{title:(0,l.jsxs)(j.Z,{children:[(0,l.jsx)("span",{children:"LLM OUT"}),$&&(0,l.jsx)(N.Z,{message:$.msg,type:$.status,showIcon:!0})]}),className:"mt-2",children:(0,l.jsx)("div",{className:" max-h-[400px] overflow-y-auto",children:(0,l.jsx)(T,{children:null==D?void 0:null===(e=D[0])||void 0===e?void 0:e.context.replace(/\\n/gm,"\n")})})})]}),(0,l.jsxs)("div",{className:"flex flex-col w-2/5 pb-8 overflow-y-auto",children:[(0,l.jsx)(b.Z,{className:"mb-4",children:(0,l.jsxs)(v.default,{form:B,children:[(0,l.jsxs)("div",{className:"flex w-full gap-1 justify-between",children:[(0,l.jsx)(v.default.Item,{label:"Type",name:"prompt_type",className:"w-2/5",rules:[{required:!0,message:"请选择类型"}],children:(0,l.jsx)(w.default,{options:L,placeholder:"请选择类型",allowClear:!0})}),(0,l.jsx)(v.default.Item,{name:"target",className:"w-3/5",rules:[{required:!0,message:"请选择场景"}],children:(0,l.jsx)(w.default,{loading:er,placeholder:"请选择场景",allowClear:!0,showSearch:!0,onChange:async e=>{await eo(e)},children:null==em?void 0:em.map(e=>(0,l.jsx)(w.default.Option,{title:e.desc,children:e.label},e.value))})})]}),"edit"===t&&(0,l.jsx)(v.default.Item,{label:"Code",name:"prompt_code",children:(0,l.jsx)(S.default,{disabled:!0})}),(0,l.jsx)(v.default.Item,{label:"Name",name:"prompt_name",className:"m-0",rules:[{required:!0,message:"请输入prompt名称"}],children:(0,l.jsx)(S.default,{placeholder:"请输入prompt名称"})})]})}),(0,l.jsx)(b.Z,{title:"输入参数",className:"mb-4",children:(0,l.jsx)(v.default,{form:Y,children:G.length>0&&G.filter(e=>"out_schema"!==e).map(e=>(0,l.jsx)(v.default.Item,{label:e,name:e,rules:[{message:"请输入".concat(e)}],children:(0,l.jsx)(S.default,{placeholder:"请输入"})},e))})}),(0,l.jsxs)(b.Z,{title:"输出结构",className:"flex flex-col flex-1",children:[(0,l.jsx)(p.ZP,{style:{...C,width:"100%",padding:4},className:O()({"bg-[#fafafa]":"light"===Z}),value:H,enableClipboard:!1,displayDataTypes:!1,objectSortKeys:!1}),(0,l.jsx)("div",{className:"flex flex-col mt-4",children:(0,l.jsxs)(v.default,{form:Q,initialValues:{model:g,temperature:.5,prompt_language:"en"},children:[(0,l.jsx)(v.default.Item,{label:"模型",name:"model",children:(0,l.jsx)(w.default,{className:"h-8 rounded-3xl",options:et,allowClear:!0,showSearch:!0})}),(0,l.jsx)(v.default.Item,{label:"温度",name:"temperature",children:(0,l.jsx)(M,{})}),(0,l.jsx)(v.default.Item,{label:"语言",name:"prompt_language",children:(0,l.jsx)(w.default,{options:[{label:"英文",value:"en"},{label:"中文",value:"zh"}]})}),(0,l.jsx)(v.default.Item,{label:"用户输入",name:"user_input",children:(0,l.jsx)(S.default,{placeholder:"请输入"})})]})}),(0,l.jsxs)(j.Z,{className:"flex justify-between",children:[(0,l.jsx)(y.ZP,{type:"primary",onClick:ec,loading:X,children:"LLM测试"}),(0,l.jsx)(y.ZP,{type:"primary",onClick:async()=>{var e;!ep&&(null===(e=D[0])||void 0===e?void 0:e.context)&&await eu()},children:"输出验证"})]})]})]})]})]})}},97804:function(e){e.exports={"prompt-container":"styles_prompt-container__S6dYE","prompt-operate-container":"styles_prompt-operate-container__cpqq1"}}},function(e){e.O(0,[7779,3791,7656,2913,8791,6184,9859,2398,418,8047,7263,1687,4393,2025,9774,2888,179],function(){return e(e.s=57954)}),_N_E=e.O()}]);