"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8510,3913],{89833:function(e,l,t){var n=t(85893),a=t(19284),r=t(25675),i=t.n(r),o=t(67294);l.Z=(0,o.memo)(e=>{let{width:l,height:t,model:r}=e,s=(0,o.useMemo)(()=>{let e=null==r?void 0:r.replaceAll("-","_").split("_")[0],l=Object.keys(a.Me);for(let t=0;t<l.length;t++){let n=l[t];if(null==e?void 0:e.includes(n))return a.Me[n]}return"/models/huggingface.svg"},[r]);return r?(0,n.jsx)(i(),{className:"rounded-full border border-gray-200 object-contain bg-white inline-block",width:l||24,height:t||24,src:s,alt:"llm",priority:!0}):null})},34943:function(e,l,t){var n=t(85893),a=t(82353),r=t(16165),i=t(67294);l.Z=e=>{let{width:l,height:t,scene:o}=e,s=(0,i.useCallback)(()=>{switch(o){case"chat_knowledge":return a.je;case"chat_with_db_execute":return a.zM;case"chat_excel":return a.DL;case"chat_with_db_qa":case"chat_dba":return a.RD;case"chat_dashboard":return a.In;case"chat_agent":return a.si;case"chat_normal":return a.O7;default:return}},[o]);return(0,n.jsx)(r.Z,{className:"w-".concat(l||7," h-").concat(t||7),component:s()})}},33984:function(e,l,t){var n=t(91321);let a=(0,n.Z)({scriptUrl:"//at.alicdn.com/t/a/font_4440880_ljyggdw605.js"});l.Z=a},2440:function(e,l,t){var n=t(25519);l.Z=()=>{var e;return JSON.parse(null!==(e=localStorage.getItem(n.C9))&&void 0!==e?e:"")}},77451:function(e,l,t){t.r(l);var n=t(85893),a=t(11746),r=t(76212),i=t(11475),o=t(65654),s=t(66184),u=t(85576),d=t(99859),c=t(93967),m=t.n(c),v=t(67294),x=t(25934),p=t(2584);let f=e=>{let{value:l,onChange:t,promptList:r}=e,[o,d]=(0,v.useState)(!1),[c,m]=(0,v.useState)();return(0,v.useEffect)(()=>{if(l){let e=null==r?void 0:r.filter(e=>e.prompt_code===l)[0];m(e)}},[r,l]),(0,n.jsxs)("div",{className:"w-2/5 flex items-center gap-2",children:[(0,n.jsx)(s.default,{className:"w-1/2",placeholder:"请选择提示语",options:r,fieldNames:{label:"prompt_name",value:"prompt_code"},onChange:e=>{let l=null==r?void 0:r.filter(l=>l.prompt_code===e)[0];m(l),null==t||t(e)},value:l,allowClear:!0,showSearch:!0}),c&&(0,n.jsxs)("span",{className:"text-sm text-blue-500 cursor-pointer",onClick:()=>d(!0),children:[(0,n.jsx)(i.Z,{className:"mr-1"}),"查看详情"]}),(0,n.jsx)(u.default,{title:"Prompt详情",open:o,footer:!1,width:"60%",onCancel:()=>d(!1),children:(0,n.jsx)(a.default,{children:null==c?void 0:c.content})})]})};l.default=e=>{var l,t;let{name:a,initValue:i,modelStrategyOptions:u,resourceTypeOptions:c,updateData:h,classNames:g,promptList:j}=e,[b]=d.default.useForm(),y=d.default.useWatch("prompt_template",b),_=d.default.useWatch("llm_strategy",b),w=d.default.useWatch("llm_strategy_value",b),[N,k]=(0,v.useState)(),[Z,C]=(0,v.useState)(!1),S=(0,v.useMemo)(()=>(null==i?void 0:i.find(e=>e.agent_name===a))||[],[i,a]),E=(0,v.useRef)([]),{run:R,loading:M,data:I}=(0,o.Z)(async()=>{var e;let[,l]=await (0,r.Vx)((0,r.m9)("priority"));return null!==(e=null==l?void 0:l.map(e=>({label:e,value:e})))&&void 0!==e?e:[]},{manual:!0});return(0,v.useEffect)(()=>{"priority"===_&&R()},[R,_]),(0,v.useEffect)(()=>{var e;let l=b.getFieldsValue();h({agent_name:a,...l,llm_strategy_value:null==l?void 0:null===(e=l.llm_strategy_value)||void 0===e?void 0:e.join(","),resources:E.current})},[b,M,a,y,_,w,h]),(0,n.jsx)("div",{className:m()(g),children:(0,n.jsxs)(d.default,{style:{width:"100%"},labelCol:{span:3},form:b,initialValues:{llm_strategy:"default",...S,llm_strategy_value:null==S?void 0:null===(l=S.llm_strategy_value)||void 0===l?void 0:l.split(",")},children:[(0,n.jsx)(d.default.Item,{label:"提示语",name:"prompt_template",children:(0,n.jsx)(f,{promptList:j})}),(0,n.jsx)(d.default.Item,{label:"模型策略",required:!0,tooltip:!0,name:"llm_strategy",children:(0,n.jsx)(s.default,{className:"w-1/5",placeholder:"请选择模型策略",options:u,allowClear:!0})}),"priority"===_&&(0,n.jsx)(d.default.Item,{label:"模型策略参数",required:!0,tooltip:!0,name:"llm_strategy_value",children:(0,n.jsx)(s.default,{mode:"multiple",className:"w-2/5",placeholder:"请选择模型策略参数",options:I,allowClear:!0})}),(0,n.jsx)(d.default.Item,{label:"可用资源",tooltip:!0,name:"resources",children:(0,n.jsx)(p.default,{resourceTypeOptions:c,initValue:null==S?void 0:null===(t=S.resources)||void 0===t?void 0:t.map(e=>({...e,uid:(0,x.Z)()})),updateData:e=>{E.current=null==e?void 0:e[1],h({agent_name:a,resources:E.current})},name:a})})]})})}},2856:function(e,l,t){t.r(l);var n=t(85893),a=t(76212),r=t(65654),i=t(99859),o=t(66184),s=t(72269),u=t(93967),d=t.n(u),c=t(67294);l.default=e=>{let{uid:l,initValue:t,updateData:u,classNames:m,resourceTypeOptions:v,setCurIcon:x}=e,[p]=i.default.useForm(),f=i.default.useWatch("type",p),h=i.default.useWatch("is_dynamic",p),g=i.default.useWatch("value",p),j=(0,c.useMemo)(()=>(null==v?void 0:v.filter(e=>"all"!==e.value))||[],[v]),{run:b,data:y,loading:_}=(0,r.Z)(async e=>{var l;let[,n]=await (0,a.Vx)((0,a.RX)({type:e}));return p.setFieldsValue({value:(null==t?void 0:t.value)||(null==n?void 0:null===(l=n[0])||void 0===l?void 0:l.key)}),n||[]},{manual:!0});(0,c.useEffect)(()=>{f&&b(f)},[b,f]);let w=(0,c.useMemo)(()=>(null==y?void 0:y.map(e=>({...e,label:e.label,value:e.key+""})))||[],[y]);return(0,c.useEffect)(()=>{let e=p.getFieldsValue(),t=(null==e?void 0:e.is_dynamic)?"":null==e?void 0:e.value;u({uid:l,...e,value:t})},[l,h,p,u,g,f]),(0,n.jsx)("div",{className:d()("flex flex-1",m),children:(0,n.jsxs)(i.default,{style:{width:"100%"},form:p,labelCol:{span:4},initialValues:{...t},children:[(0,n.jsx)(i.default.Item,{label:"资源类型",name:"type",children:(0,n.jsx)(o.default,{className:"w-2/5",options:j,onChange:e=>{x({uid:l,icon:e})}})}),(0,n.jsx)(i.default.Item,{label:"动态",name:"is_dynamic",children:(0,n.jsx)(s.Z,{style:{background:h?"#1677ff":"#ccc"}})}),!h&&(0,n.jsxs)(n.Fragment,{children:[" ","image_file"===f||"internet"===f||["text_file","excel_file"].includes(f)?null:(0,n.jsx)(i.default.Item,{label:"参数",name:"value",required:!0,children:(0,n.jsx)(o.default,{placeholder:"请选择参数",options:w,loading:_,className:"w-3/5",allowClear:!0})})]})]})})}},2584:function(e,l,t){t.r(l),t.d(l,{default:function(){return j}});var n=t(85893),a=t(32983),r=t(93967),i=t.n(r),o=e=>{let{className:l,imgUrl:t="/images/empty.png"}=e;return(0,n.jsx)("div",{className:i()("m-auto",{className:l}),children:(0,n.jsx)(a.Z,{image:t,imageStyle:{margin:"0 auto",width:"100%",height:"100%"}})})},s=t(48689),u=t(24969),d=t(66184),c=t(22850),m=t(86738),v=t(14726),x=t(96486),p=t(67294),f=t(25934),h=t(83072),g=t(2856),j=e=>{var l;let{name:t,updateData:a,resourceTypeOptions:r,initValue:j}=e,b=(0,p.useRef)(j||[]),[y,_]=(0,p.useState)({uid:"",icon:""}),[w,N]=(0,p.useState)((null==j?void 0:j.map((e,l)=>({...e,icon:e.type,initVal:e})))||[]),[k,Z]=(0,p.useState)([...w]),[C,S]=(0,p.useState)((null==w?void 0:null===(l=w[0])||void 0===l?void 0:l.uid)||""),[E,R]=(0,p.useState)(""),M=(e,l)=>{var n,r;null==e||e.stopPropagation();let i=null===(n=b.current)||void 0===n?void 0:n.findIndex(e=>e.uid===C),o=null==w?void 0:w.filter(e=>e.uid!==l.uid);b.current=b.current.filter(e=>e.uid!==l.uid)||[],a([t,b.current]),N(o),i===(null==w?void 0:w.length)-1&&0!==i&&setTimeout(()=>{var e;S((null==o?void 0:null===(e=o[o.length-1])||void 0===e?void 0:e.uid)||"")},0),S((null==o?void 0:null===(r=o[i])||void 0===r?void 0:r.uid)||"")};return(0,p.useEffect)(()=>{Z([...w])},[w]),(0,p.useEffect)(()=>{N(w.map(e=>(null==y?void 0:y.uid)===e.uid?{...e,icon:y.icon}:e))},[y]),(0,n.jsxs)("div",{className:"flex flex-1  h-64 px-3 py-4 border border-[#d6d8da] rounded-md",children:[(0,n.jsxs)("div",{className:"flex flex-col w-40 h-full",children:[(0,n.jsx)(d.default,{options:r,className:"w-full h-8",variant:"borderless",defaultValue:"all",onChange:e=>{var l,t;if("all"===e)Z(w),S((null==w?void 0:null===(l=w[0])||void 0===l?void 0:l.uid)||"");else{let l=null==w?void 0:w.filter(l=>(null==l?void 0:l.icon)===e);S((null==l?void 0:null===(t=l[0])||void 0===t?void 0:t.uid)||""),Z(l)}}}),(0,n.jsx)("div",{className:"flex flex-1 flex-col gap-1 overflow-y-auto",children:null==k?void 0:k.map(e=>(0,n.jsxs)("div",{className:i()("flex h-8 items-center px-3 pl-[0.6rem] rounded-md hover:bg-[#f5faff] hover:dark:bg-[#606264] cursor-pointer relative",{"bg-[#f5faff] dark:bg-[#606264]":e.uid===C}),onClick:()=>{S(e.uid||"")},onMouseEnter:()=>{R(e.uid||"")},onMouseLeave:()=>{R("")},children:[h.resourceTypeIcon[e.icon||""],(0,n.jsx)(c.Z.Text,{className:i()("flex flex-1 items-center text-sm p-0 m-0 mx-2 line-clamp-1",{"text-[#0c75fc]":e.uid===C}),editable:{autoSize:{maxRows:1},onChange:l=>{N(w.map(t=>t.uid===e.uid?{...t,name:l}:t)),b.current=b.current.map(t=>t.uid===e.uid?{...t,name:l}:t),a([t,b.current])}},ellipsis:{tooltip:!0},children:e.name}),(0,n.jsx)(m.Z,{title:"您确定要删除吗？",onConfirm:l=>{M(l,e)},onCancel:e=>null==e?void 0:e.stopPropagation(),children:(0,n.jsx)(s.Z,{className:"text-sm cursor-pointer  absolute right-2 ".concat(E===e.uid?"opacity-100":"opacity-0"),style:{top:"50%",transform:"translateY(-50%)"},onClick:e=>e.stopPropagation()})})]},e.uid))}),(0,n.jsx)(v.ZP,{className:"w-full h-8",type:"dashed",block:!0,icon:(0,n.jsx)(u.Z,{}),onClick:()=>{var e,l;let n=(0,f.Z)();b.current=(0,x.concat)(b.current,[{is_dynamic:!1,type:null===(e=null==r?void 0:r.filter(e=>"all"!==e.value))||void 0===e?void 0:e[0].value,value:"",uid:n,name:"资源".concat(b.current.length+1)}].filter(Boolean)),a([t,b.current]),N(e=>{var l,t,a;return[...e,{icon:(null===(l=null==r?void 0:r.filter(e=>"all"!==e.value))||void 0===l?void 0:null===(t=l[0])||void 0===t?void 0:t.value)||"",uid:n,initVal:{is_dynamic:!1,type:null===(a=null==r?void 0:r.filter(e=>"all"!==e.value))||void 0===a?void 0:a[0].value,value:"",uid:n,name:"资源".concat(e.length+1)},name:"资源".concat(e.length+1)}]}),S(n),_({uid:n,icon:null===(l=null==r?void 0:r.filter(e=>"all"!==e.value))||void 0===l?void 0:l[0].value})},children:"添加资源"})]}),(0,n.jsx)("div",{className:"flex flex-1 ml-6 ",children:k&&(null==k?void 0:k.length)>0?(0,n.jsx)("div",{className:"flex flex-1",children:null==k?void 0:k.map(e=>(0,n.jsx)(g.default,{classNames:e.uid===C?"block":"hidden",resourceTypeOptions:r,initValue:e.initVal,setCurIcon:_,updateData:e=>{var l;b.current=null===(l=b.current)||void 0===l?void 0:l.map(l=>(null==l?void 0:l.uid)===(null==e?void 0:e.uid)?{...l,...e}:l),a([t,b.current])},uid:e.uid||""},e.uid))}):(0,n.jsx)(o,{className:"w-40 h-40"})})]})}},83072:function(e,l,t){t.r(l),t.d(l,{agentIcon:function(){return b},resourceTypeIcon:function(){return y}});var n=t(85893),a=t(33984),r=t(89035),i=t(48869),o=t(61086),s=t(57132),u=t(97879),d=t(32319),c=t(79383),m=t(13520),v=t(14079),x=t(10524),p=t(56466),f=t(26911),h=t(97175),g=t(16801),j=t(13179);t(67294);let b={CodeEngineer:(0,n.jsx)(r.Z,{}),Reporter:(0,n.jsx)(i.Z,{}),DataScientist:(0,n.jsx)(o.Z,{}),Summarizer:(0,n.jsx)(s.Z,{}),ToolExpert:(0,n.jsx)(a.Z,{type:"icon-plugin",style:{fontSize:17.25,marginTop:2}}),Indicator:(0,n.jsx)(u.Z,{}),Dbass:(0,n.jsx)(d.Z,{})},y={all:(0,n.jsx)(c.Z,{}),database:(0,n.jsx)(m.Z,{}),knowledge:(0,n.jsx)(v.Z,{}),internet:(0,n.jsx)(x.Z,{}),plugin:(0,n.jsx)(p.Z,{}),text_file:(0,n.jsx)(f.Z,{}),excel_file:(0,n.jsx)(h.Z,{}),image_file:(0,n.jsx)(g.Z,{}),awel_flow:(0,n.jsx)(j.Z,{})};l.default=()=>(0,n.jsx)(n.Fragment,{})},56397:function(e,l,t){t.r(l);var n=t(85893),a=t(34943),r=t(58638),i=t(31418),o=t(22850),s=t(20640),u=t.n(s),d=t(67294),c=t(73913);l.default=(0,d.memo)(()=>{var e;let{appInfo:l}=(0,d.useContext)(c.MobileChatContext),{message:t}=i.Z.useApp(),[s,m]=(0,d.useState)(0);if(!(null==l?void 0:l.app_code))return null;let v=async()=>{let e=u()("dingtalk://dingtalkclient/page/link?url=".concat(encodeURIComponent(location.href),"&pc_slide=true"));t[e?"success":"error"](e?"复制成功":"复制失败")};return s>6&&t.info(JSON.stringify(window.navigator.userAgent),2,()=>{m(0)}),(0,n.jsxs)("header",{className:"flex w-full items-center justify-between bg-[rgba(255,255,255,0.9)] border dark:bg-black dark:border-[rgba(255,255,255,0.6)] rounded-xl mx-auto px-4 py-2 mb-4 sticky top-4 z-50 mt-4 shadow-md",children:[(0,n.jsxs)("div",{className:"flex gap-2 items-center",onClick:()=>m(s+1),children:[(0,n.jsx)(a.Z,{scene:(null==l?void 0:null===(e=l.team_context)||void 0===e?void 0:e.chat_scene)||"chat_agent",width:8,height:8}),(0,n.jsxs)("div",{className:"flex flex-col ml-2",children:[(0,n.jsx)(o.Z.Text,{className:"text-md font-bold line-clamp-2",children:null==l?void 0:l.app_name}),(0,n.jsx)(o.Z.Text,{className:"text-sm line-clamp-2",children:null==l?void 0:l.app_describe})]})]}),(0,n.jsx)("div",{onClick:v,className:"flex items-center justify-center w-10 h-10 bg-[#ffffff99] dark:bg-[rgba(255,255,255,0.2)] border border-white dark:border-[rgba(255,255,255,0.2)] rounded-[50%] cursor-pointer",children:(0,n.jsx)(r.Z,{className:"text-lg"})})]})})},74638:function(e,l,t){t.r(l);var n=t(85893),a=t(76212),r=t(62418),i=t(25519),o=t(30159),s=t(87740),u=t(50888),d=t(52645),c=t(27496),m=t(1375),v=t(65654),x=t(66309),p=t(55241),f=t(75081),h=t(79531),g=t(14726),j=t(93967),b=t.n(j),y=t(39332),_=t(67294),w=t(73913),N=t(7001),k=t(73749),Z=t(97109),C=t(83454);let S=["magenta","orange","geekblue","purple","cyan","green"];l.default=()=>{var e,l;let t=(0,y.useSearchParams)(),j=null!==(l=null==t?void 0:t.get("ques"))&&void 0!==l?l:"",{history:E,model:R,scene:M,temperature:I,resource:V,conv_uid:O,appInfo:T,scrollViewRef:P,order:A,userInput:D,ctrl:z,canAbort:W,canNewChat:q,setHistory:F,setCanNewChat:L,setCarAbort:J,setUserInput:U}=(0,_.useContext)(w.MobileChatContext),[B,H]=(0,_.useState)(!1),[$,K]=(0,_.useState)(!1),G=async e=>{var l,t,n;U(""),z.current=new AbortController;let a={chat_mode:M,model_name:R,user_input:e||D,conv_uid:O,temperature:I,app_code:null==T?void 0:T.app_code,...V&&{select_param:JSON.stringify(V)}};if(E&&E.length>0){let e=null==E?void 0:E.filter(e=>"view"===e.role);A.current=e[e.length-1].order+1}let o=[{role:"human",context:e||D,model_name:R,order:A.current,time_stamp:0},{role:"view",context:"",model_name:R,order:A.current,time_stamp:0,thinking:!0}],s=o.length-1;F([...E,...o]),L(!1);try{await (0,m.L)("".concat(null!==(l=C.env.API_BASE_URL)&&void 0!==l?l:"","/api/v1/chat/completions"),{method:"POST",headers:{"Content-Type":"application/json",[i.gp]:null!==(t=(0,r.n5)())&&void 0!==t?t:""},signal:z.current.signal,body:JSON.stringify(a),openWhenHidden:!0,async onopen(e){if(e.ok&&e.headers.get("content-type")===m.a)return},onclose(){var e;null===(e=z.current)||void 0===e||e.abort(),L(!0),J(!1)},onerror(e){throw Error(e)},onmessage:e=>{let l=e.data;try{l=JSON.parse(l).vis}catch(e){l.replaceAll("\\n","\n")}"[DONE]"===l?(L(!0),J(!1)):(null==l?void 0:l.startsWith("[ERROR]"))?(o[s].context=null==l?void 0:l.replace("[ERROR]",""),o[s].thinking=!1,F([...E,...o]),L(!0),J(!1)):(J(!0),o[s].context=l,o[s].thinking=!1,F([...E,...o]))}})}catch(e){null===(n=z.current)||void 0===n||n.abort(),o[s].context="Sorry, we meet some error, please try again later.",o[s].thinking=!1,F([...o]),L(!0),J(!1)}},X=async()=>{D.trim()&&q&&await G()};(0,_.useEffect)(()=>{var e,l;null===(e=P.current)||void 0===e||e.scrollTo({top:null===(l=P.current)||void 0===l?void 0:l.scrollHeight,behavior:"auto"})},[E,P]);let Y=(0,_.useMemo)(()=>{if(!T)return[];let{param_need:e=[]}=T;return null==e?void 0:e.map(e=>e.type)},[T]),Q=(0,_.useMemo)(()=>{var e;return 0===E.length&&T&&!!(null==T?void 0:null===(e=T.recommend_questions)||void 0===e?void 0:e.length)},[E,T]),{run:ee,loading:el}=(0,v.Z)(async()=>await (0,a.Vx)((0,a.zR)(O)),{manual:!0,onSuccess:()=>{F([])}});return(0,_.useEffect)(()=>{j&&R&&O&&T&&G(j)},[T,O,R,j]),(0,n.jsxs)("div",{className:"flex flex-col",children:[Q&&(0,n.jsx)("ul",{children:null==T?void 0:null===(e=T.recommend_questions)||void 0===e?void 0:e.map((e,l)=>(0,n.jsx)("li",{className:"mb-3",children:(0,n.jsx)(x.Z,{color:S[l],className:"p-2 rounded-xl",onClick:async()=>{G(e.question)},children:e.question})},e.id))}),(0,n.jsxs)("div",{className:"flex items-center justify-between gap-1",children:[(0,n.jsxs)("div",{className:"flex gap-2 mb-1 w-full overflow-x-auto",children:[(null==Y?void 0:Y.includes("model"))&&(0,n.jsx)(N.default,{}),(null==Y?void 0:Y.includes("resource"))&&(0,n.jsx)(k.default,{}),(null==Y?void 0:Y.includes("temperature"))&&(0,n.jsx)(Z.default,{})]}),(0,n.jsxs)("div",{className:"flex items-center justify-between text-lg font-bold",children:[(0,n.jsx)(p.Z,{content:"暂停回复",trigger:["hover"],children:(0,n.jsx)(o.Z,{className:b()("p-2 cursor-pointer",{"text-[#0c75fc]":W,"text-gray-400":!W}),onClick:()=>{var e;W&&(null===(e=z.current)||void 0===e||e.abort(),setTimeout(()=>{J(!1),L(!0)},100))}})}),(0,n.jsx)(p.Z,{content:"再来一次",trigger:["hover"],children:(0,n.jsx)(s.Z,{className:b()("p-2 cursor-pointer",{"text-gray-400":!E.length||!q}),onClick:()=>{var e,l;if(!q||0===E.length)return;let t=null===(e=null===(l=E.filter(e=>"human"===e.role))||void 0===l?void 0:l.slice(-1))||void 0===e?void 0:e[0];G((null==t?void 0:t.context)||"")}})}),el?(0,n.jsx)(f.Z,{spinning:el,indicator:(0,n.jsx)(u.Z,{style:{fontSize:18},spin:!0}),className:"p-2"}):(0,n.jsx)(p.Z,{content:"清除历史",trigger:["hover"],children:(0,n.jsx)(d.Z,{className:b()("p-2 cursor-pointer",{"text-gray-400":!E.length||!q}),onClick:()=>{q&&ee()}})})]})]}),(0,n.jsxs)("div",{className:b()("flex py-2 px-3 items-center justify-between bg-white dark:bg-[#242733] dark:border-[#6f7f95] rounded-xl border",{"border-[#0c75fc] dark:border-[rgba(12,117,252,0.8)]":B}),children:[(0,n.jsx)(h.default.TextArea,{placeholder:"可以问我任何问题",className:"w-full resize-none border-0 p-0 focus:shadow-none",value:D,autoSize:{minRows:1},onKeyDown:e=>{if("Enter"===e.key&&!e.shiftKey){if($){e.preventDefault();return}D.trim()&&(e.preventDefault(),X())}},onChange:e=>{U(e.target.value)},onFocus:()=>{H(!0)},onBlur:()=>H(!1),onCompositionStartCapture:()=>{K(!0)},onCompositionEndCapture:()=>{setTimeout(()=>{K(!1)},0)}}),(0,n.jsx)(g.ZP,{type:"primary",className:b()("flex items-center justify-center rounded-lg bg-button-gradient border-0 ml-2",{"opacity-40 cursor-not-allowed":!D.trim()||!q}),onClick:X,children:q?(0,n.jsx)(c.Z,{}):(0,n.jsx)(f.Z,{indicator:(0,n.jsx)(u.Z,{className:"text-white"})})})]})]})}},7001:function(e,l,t){t.r(l);var n=t(85893),a=t(89833),r=t(41468),i=t(94668),o=t(85418),s=t(55241),u=t(67294),d=t(73913);l.default=()=>{let{modelList:e}=(0,u.useContext)(r.p),{model:l,setModel:t}=(0,u.useContext)(d.MobileChatContext),c=(0,u.useMemo)(()=>e.length>0?e.map(e=>({label:(0,n.jsxs)("div",{className:"flex items-center gap-2",onClick:()=>{t(e)},children:[(0,n.jsx)(a.Z,{width:14,height:14,model:e}),(0,n.jsx)("span",{className:"text-xs",children:e})]}),key:e})):[],[e,t]);return(0,n.jsx)(o.Z,{menu:{items:c},placement:"top",trigger:["click"],children:(0,n.jsx)(s.Z,{content:l,children:(0,n.jsxs)("div",{className:"flex items-center gap-1 border rounded-xl bg-white dark:bg-black p-2 flex-shrink-0",children:[(0,n.jsx)(a.Z,{width:16,height:16,model:l}),(0,n.jsx)("span",{className:"text-xs font-medium line-clamp-1",style:{maxWidth:96},children:l}),(0,n.jsx)(i.Z,{rotate:90})]})})})}},46568:function(e,l,t){t.r(l);var n=t(85893),a=t(25675),r=t.n(a),i=t(67294);l.default=(0,i.memo)(e=>{let{width:l,height:t,src:a,label:i}=e;return(0,n.jsx)(r(),{width:l||14,height:t||14,src:a,alt:i||"db-icon",priority:!0})})},73749:function(e,l,t){t.r(l);var n=t(85893),a=t(76212),r=t(62418),i=t(50888),o=t(94668),s=t(83266),u=t(65654),d=t(75081),c=t(84553),m=t(85418),v=t(67294),x=t(73913),p=t(46568);l.default=()=>{let{appInfo:e,resourceList:l,scene:t,model:f,conv_uid:h,getChatHistoryRun:g,setResource:j,resource:b}=(0,v.useContext)(x.MobileChatContext),[y,_]=(0,v.useState)(null),w=(0,v.useMemo)(()=>{var l,t,n;return null===(l=null==e?void 0:null===(t=e.param_need)||void 0===t?void 0:t.filter(e=>"resource"===e.type))||void 0===l?void 0:null===(n=l[0])||void 0===n?void 0:n.value},[e]),N=(0,v.useMemo)(()=>l&&l.length>0?l.map(e=>({label:(0,n.jsxs)("div",{className:"flex items-center gap-2",onClick:()=>{_(e),j(e.space_id||e.param)},children:[(0,n.jsx)(p.default,{width:14,height:14,src:r.S$[e.type].icon,label:r.S$[e.type].label}),(0,n.jsx)("span",{className:"text-xs",children:e.param})]}),key:e.space_id||e.param})):[],[l,j]),{run:k,loading:Z}=(0,u.Z)(async e=>{let[,l]=await (0,a.Vx)((0,a.qn)({convUid:h,chatMode:t,data:e,model:f,config:{timeout:36e5}}));return j(l),l},{manual:!0,onSuccess:async()=>{await g()}}),C=async e=>{let l=new FormData;l.append("doc_file",null==e?void 0:e.file),await k(l)},S=(0,v.useMemo)(()=>Z?(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsx)(d.Z,{size:"small",indicator:(0,n.jsx)(i.Z,{spin:!0})}),(0,n.jsx)("span",{className:"text-xs",children:"上传中"})]}):b?(0,n.jsxs)("div",{className:"flex gap-1",children:[(0,n.jsx)("span",{className:"text-xs",children:b.file_name}),(0,n.jsx)(o.Z,{rotate:90})]}):(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsx)(s.Z,{className:"text-base"}),(0,n.jsx)("span",{className:"text-xs",children:"上传文件"})]}),[Z,b]);return(0,n.jsx)(n.Fragment,{children:(()=>{switch(w){case"excel_file":case"text_file":case"image_file":return(0,n.jsx)("div",{className:"flex items-center justify-center gap-1 border rounded-xl bg-white dark:bg-black px-2 flex-shrink-0",children:(0,n.jsx)(c.default,{name:"file",accept:".xlsx,.xls",maxCount:1,showUploadList:!1,beforeUpload:()=>!1,onChange:C,className:"flex h-full w-full items-center justify-center",children:S})});case"database":case"knowledge":case"plugin":case"awel_flow":var e,t,a,i,s;if(!(null==l?void 0:l.length))return null;return(0,n.jsx)(m.Z,{menu:{items:N},placement:"top",trigger:["click"],children:(0,n.jsxs)("div",{className:"flex items-center gap-1 border rounded-xl bg-white dark:bg-black p-2 flex-shrink-0",children:[(0,n.jsx)(p.default,{width:14,height:14,src:null===(e=r.S$[(null==y?void 0:y.type)||(null==l?void 0:null===(t=l[0])||void 0===t?void 0:t.type)])||void 0===e?void 0:e.icon,label:null===(a=r.S$[(null==y?void 0:y.type)||(null==l?void 0:null===(i=l[0])||void 0===i?void 0:i.type)])||void 0===a?void 0:a.label}),(0,n.jsx)("span",{className:"text-xs font-medium",children:(null==y?void 0:y.param)||(null==l?void 0:null===(s=l[0])||void 0===s?void 0:s.param)}),(0,n.jsx)(o.Z,{rotate:90})]})})}})()})}},97109:function(e,l,t){t.r(l);var n=t(85893),a=t(85418),r=t(71338),i=t(67294),o=t(73913),s=t(33984);l.default=()=>{let{temperature:e,setTemperature:l}=(0,i.useContext)(o.MobileChatContext),t=e=>{isNaN(e)||l(e)};return(0,n.jsx)(a.Z,{trigger:["click"],dropdownRender:()=>(0,n.jsx)("div",{className:"flex h-28 bg-white dark:bg-[rgba(255,255,255,0.5)] items-center justify-center rounded-xl py-3",children:(0,n.jsx)(r.Z,{defaultValue:.5,max:1,min:0,step:.1,vertical:!0,onChange:t,value:e})}),placement:"top",children:(0,n.jsxs)("div",{className:"flex items-center justify-between border rounded-xl bg-white dark:bg-black w-14 p-2 flex-shrink-0",children:[(0,n.jsx)(s.Z,{type:"icon-icons-temperature",className:"text-sm"}),(0,n.jsx)("span",{className:"text-xs font-medium",children:e})]})})}},73913:function(e,l,t){t.r(l),t.d(l,{MobileChatContext:function(){return b}});var n=t(85893),a=t(41468),r=t(76212),i=t(2440),o=t(62418),s=t(25519),u=t(1375),d=t(65654),c=t(75081),m=t(5152),v=t.n(m),x=t(39332),p=t(67294),f=t(56397),h=t(74638),g=t(83454);let j=v()(()=>Promise.all([t.e(3662),t.e(7034),t.e(6184),t.e(2398),t.e(4567),t.e(1980),t.e(418),t.e(7434),t.e(3106),t.e(5265),t.e(2783),t.e(3761),t.e(7582),t.e(9946),t.e(7263),t.e(3846),t.e(7906),t.e(9071),t.e(14)]).then(t.bind(t,36818)),{loadableGenerated:{webpack:()=>[36818]},ssr:!1}),b=(0,p.createContext)({model:"",temperature:.5,resource:null,setModel:()=>{},setTemperature:()=>{},setResource:()=>{},scene:"",history:[],setHistory:()=>{},scrollViewRef:{current:null},appInfo:{},conv_uid:"",resourceList:[],order:{current:1},handleChat:()=>Promise.resolve(),canAbort:!1,setCarAbort:()=>{},canNewChat:!1,setCanNewChat:()=>{},ctrl:{current:void 0},userInput:"",setUserInput:()=>{},getChatHistoryRun:()=>{}});l.default=()=>{var e,l;let t=(0,x.useSearchParams)(),m=null!==(e=null==t?void 0:t.get("chat_scene"))&&void 0!==e?e:"",v=null!==(l=null==t?void 0:t.get("app_code"))&&void 0!==l?l:"",{modelList:y}=(0,p.useContext)(a.p),[_,w]=(0,p.useState)([]),[N,k]=(0,p.useState)(""),[Z,C]=(0,p.useState)(.5),[S,E]=(0,p.useState)(null),R=(0,p.useRef)(null),[M,I]=(0,p.useState)(""),[V,O]=(0,p.useState)(!1),[T,P]=(0,p.useState)(!0),A=(0,p.useRef)(),D=(0,p.useRef)(1),z=(0,i.Z)(),W=(0,p.useMemo)(()=>"".concat(null==z?void 0:z.user_no,"_").concat(v),[v,z]),{run:q,loading:F}=(0,d.Z)(async()=>await (0,r.Vx)((0,r.$i)("".concat(null==z?void 0:z.user_no,"_").concat(v))),{manual:!0,onSuccess:e=>{let[,l]=e,t=null==l?void 0:l.filter(e=>"view"===e.role);t&&t.length>0&&(D.current=t[t.length-1].order+1),w(l||[])}}),{data:L,run:J,loading:U}=(0,d.Z)(async e=>{let[,l]=await (0,r.Vx)((0,r.BN)(e));return null!=l?l:{}},{manual:!0}),{run:B,data:H,loading:$}=(0,d.Z)(async()=>{var e,l;let[,t]=await (0,r.Vx)((0,r.vD)(m));return E((null==t?void 0:null===(e=t[0])||void 0===e?void 0:e.space_id)||(null==t?void 0:null===(l=t[0])||void 0===l?void 0:l.param)),null!=t?t:[]},{manual:!0}),{run:K,loading:G}=(0,d.Z)(async()=>{let[,e]=await (0,r.Vx)((0,r.iP)());return null!=e?e:[]},{manual:!0,onSuccess:e=>{var l;let t=null===(l=null==e?void 0:e.filter(e=>e.conv_uid===W))||void 0===l?void 0:l[0];(null==t?void 0:t.select_param)&&E(JSON.parse(null==t?void 0:t.select_param))}});(0,p.useEffect)(()=>{m&&v&&y.length&&J({chat_scene:m,app_code:v})},[v,m,J,y]),(0,p.useEffect)(()=>{v&&q()},[v]),(0,p.useEffect)(()=>{if(y.length>0){var e,l,t;let n=null===(e=null==L?void 0:null===(l=L.param_need)||void 0===l?void 0:l.filter(e=>"model"===e.type))||void 0===e?void 0:null===(t=e[0])||void 0===t?void 0:t.value;k(n||y[0])}},[y,L]),(0,p.useEffect)(()=>{var e,l,t;let n=null===(e=null==L?void 0:null===(l=L.param_need)||void 0===l?void 0:l.filter(e=>"temperature"===e.type))||void 0===e?void 0:null===(t=e[0])||void 0===t?void 0:t.value;C(n||.5)},[L]),(0,p.useEffect)(()=>{if(m&&(null==L?void 0:L.app_code)){var e,l,t,n,a,r;let i=null===(e=null==L?void 0:null===(l=L.param_need)||void 0===l?void 0:l.filter(e=>"resource"===e.type))||void 0===e?void 0:null===(t=e[0])||void 0===t?void 0:t.value,o=null===(n=null==L?void 0:null===(a=L.param_need)||void 0===a?void 0:a.filter(e=>"resource"===e.type))||void 0===n?void 0:null===(r=n[0])||void 0===r?void 0:r.bind_value;o&&E(o),["database","knowledge","plugin","awel_flow"].includes(i)&&!o&&B()}},[L,m,B]);let X=async e=>{var l,t,n;I(""),A.current=new AbortController;let a={chat_mode:m,model_name:N,user_input:e||M,conv_uid:W,temperature:Z,app_code:null==L?void 0:L.app_code,...S&&{select_param:S}};if(_&&_.length>0){let e=null==_?void 0:_.filter(e=>"view"===e.role);D.current=e[e.length-1].order+1}let r=[{role:"human",context:e||M,model_name:N,order:D.current,time_stamp:0},{role:"view",context:"",model_name:N,order:D.current,time_stamp:0,thinking:!0}],i=r.length-1;w([..._,...r]),P(!1);try{await (0,u.L)("".concat(null!==(l=g.env.API_BASE_URL)&&void 0!==l?l:"","/api/v1/chat/completions"),{method:"POST",headers:{"Content-Type":"application/json",[s.gp]:null!==(t=(0,o.n5)())&&void 0!==t?t:""},signal:A.current.signal,body:JSON.stringify(a),openWhenHidden:!0,async onopen(e){if(e.ok&&e.headers.get("content-type")===u.a)return},onclose(){var e;null===(e=A.current)||void 0===e||e.abort(),P(!0),O(!1)},onerror(e){throw Error(e)},onmessage:e=>{let l=e.data;try{l=JSON.parse(l).vis}catch(e){l.replaceAll("\\n","\n")}"[DONE]"===l?(P(!0),O(!1)):(null==l?void 0:l.startsWith("[ERROR]"))?(r[i].context=null==l?void 0:l.replace("[ERROR]",""),r[i].thinking=!1,w([..._,...r]),P(!0),O(!1)):(O(!0),r[i].context=l,r[i].thinking=!1,w([..._,...r]))}})}catch(e){null===(n=A.current)||void 0===n||n.abort(),r[i].context="Sorry, we meet some error, please try again later.",r[i].thinking=!1,w([...r]),P(!0),O(!1)}};return(0,p.useEffect)(()=>{m&&"chat_agent"!==m&&K()},[m,K]),(0,n.jsx)(b.Provider,{value:{model:N,resource:S,setModel:k,setTemperature:C,setResource:E,temperature:Z,appInfo:L,conv_uid:W,scene:m,history:_,scrollViewRef:R,setHistory:w,resourceList:H,order:D,handleChat:X,setCanNewChat:P,ctrl:A,canAbort:V,setCarAbort:O,canNewChat:T,userInput:M,setUserInput:I,getChatHistoryRun:q},children:(0,n.jsx)(c.Z,{size:"large",className:"flex h-screen w-screen justify-center items-center max-h-screen",spinning:F||U||$||G,children:(0,n.jsxs)("div",{className:"flex flex-col h-screen bg-gradient-light dark:bg-gradient-dark p-4 pt-0",children:[(0,n.jsxs)("div",{ref:R,className:"flex flex-col flex-1 overflow-y-auto mb-3",children:[(0,n.jsx)(f.default,{}),(0,n.jsx)(j,{})]}),(null==L?void 0:L.app_code)&&(0,n.jsx)(h.default,{})]})})})}}}]);